var nugget;(()=>{"use strict";var e={d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{asset:()=>m,canvas:()=>s,element:()=>o});const n={scroller:void 0,isPaused:!0,progress:split_inner_bottom.scrollLeft,start:function(){let e=document.querySelector("#playToggle");e.setAttribute("onclick","nugget.element.player.stop()"),e.innerHTML='<i class="fas fa-pause text-light"></i>',n.scroller=setInterval((function(){let e=Number(timeline_bar.style.left.split("px")[0])+4;timeline_bar.style.left=`${e}px`,n.progress=e,split_inner_bottom.innerWidth+split_inner_bottom.offsetWidth>=split_inner_bottom.offsetWidth&&n.stop(),r.play()}),20),n.isPaused=!1},stop:function(){clearInterval(n.scroller),n.isPaused=!0;let e=document.querySelector("#playToggle");e.setAttribute("onclick","nugget.element.player.start()"),e.innerHTML='<i class="fas fa-play text-light"></i>'},reset:function(){timeline_bar.style.left="0px",n.progress=0,n.isPaused=!0}},l={event:{drag:{onmousedown:function(e){valueEvent.elementBar.blob=e.getAttribute("value"),valueEvent.elementBar.isDrag=!0,valueEvent.elementBar.e=e,valueEvent.elementBar.criteria.x=valueEvent.mouse.x-Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")),valueEvent.elementBar.criteria.y=valueEvent.mouse.y},onmouseup:function(e){valueEvent.elementBar.isDrag=!1}},resize:{onmousedown:function(e,t="left"){valueEvent.elementBar.blob=e.parentNode.getAttribute("value"),valueEvent.elementBar.isResize=!0,valueEvent.elementBar.resizeLocation=t,valueEvent.elementBar.isDrag=!1,valueEvent.elementBar.e=e.parentNode,valueEvent.elementBar.criteriaResize.x="left"==t?valueEvent.mouse.x-Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")):Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")),valueEvent.elementBar.criteriaResize.y=valueEvent.mouse.y,valueEvent.elementBar.criteria.duration=nugget.element.timeline[valueEvent.elementBar.blob.split("/")[3]].duration+Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,""))},onmouseup:function(e){valueEvent.elementBar.isResize=!1}}},append:function(e){document.querySelector("#split_inner_bottom").insertAdjacentHTML("beforeend",`<div class="element-bar" style="width: 1000px; left: 0px;" onmousedown="nugget.element.bar.event.drag.onmousedown(this)" value="${e}">\n            ${e}\n            <div class="element-bar-resize-left position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedown(this, 'left')"></div>\n            <div class="element-bar-resize-right position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedown(this, 'right')"></div>\n\n        </div>`)},drag:function(e,t){valueEvent.elementBar.e.style.left=`${e}px`;let n=valueEvent.elementBar.blob.split("/")[3];nugget.element.timeline[n].startTime=e},resizeTime:function(e,t="left"){let n=valueEvent.elementBar.blob.split("/")[3],l=valueEvent.elementBar.criteria.duration;"left"==t?(valueEvent.elementBar.e.style.left=`${e}px`,valueEvent.elementBar.e.style.width=l-e+"px",nugget.element.timeline[n].startTime=e,nugget.element.timeline[n].duration=Number(valueEvent.elementBar.e.style.width.split("px")[0])):(valueEvent.elementBar.e.style.left=`${valueEvent.elementBar.criteriaResize.x}px`,valueEvent.elementBar.e.style.width=split_inner_bottom.scrollLeft+valueEvent.mouse.x-valueEvent.elementBar.criteriaResize.x+"px",nugget.element.timeline[n].startTime=valueEvent.elementBar.criteriaResize.x,nugget.element.timeline[n].duration=Number(valueEvent.elementBar.e.style.width.split("px")[0]))}},i={upload:{image:function(e,t){let n=document.createElement("img"),l=e.split("/")[3];n.src=e,n.onload=function(){var i=n.width/10,o=n.height/10;nugget.element.timeline[l]={startTime:0,duration:1e3,location:{x:0,y:0},width:i,height:o,localpath:t},r.show(e)}}},drag:function(e,t,n){let l=e.querySelector("img").getAttribute("src").split("/")[3];e.style.top=`${n}px`,e.style.left=`${t}px`,nugget.element.timeline[l].location.x=t,nugget.element.timeline[l].location.y=n,preview.clear(),preview.render()},dragover:function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){e.stopPropagation(),e.preventDefault()}},r={previewRatio:1920/preview.width,show:function(e){let t=e.split("/")[3];null==document.getElementById(`element-${t}`)?control.insertAdjacentHTML("beforeend",`\n            <div id="element-${t}" class="element-drag" style='width: ${nugget.element.timeline[t].width}px; top: 0px; left: 0px;' draggable="true">\n            <img src="${e}" alt="" class="element-image" draggable="false">\n            </div>\n            `):document.querySelector(`#element-${t}`).classList.remove("d-none")},hide:function(e){let t=e.split("/")[3];document.querySelector(`#element-${t}`).classList.add("d-none")},play:function(){let e;for(e in preview.render(),nugget.element.timeline){let t=`blob:${location.origin}/${e}`;nugget.element.timeline[e].startTime>n.progress||nugget.element.timeline[e].startTime+nugget.element.timeline[e].duration<n.progress?r.hide(t):r.show(t)}}},o={timeline:{},player:n,bar:l,control:i,preview:r},a={mediaRecorder:void 0,resize:function(){let e=.65*window.innerWidth,t=9*e/16;preview.width=e,preview.height=t,preview.style.width=`${e}px`,preview.style.height=`${t}px`,video.style.width=`${e}px`,video.style.height=`${t}px`,nugget.element.preview.previewRatio=1920/e},render:function(e){let t,n=e.getContext("2d");for(t in preview.clear(),nugget.element.timeline){let e=`blob:${location.origin}/${t}`;if(nugget.element.timeline[t].startTime>nugget.element.player.progress||nugget.element.timeline[t].startTime+nugget.element.timeline[t].duration<nugget.element.player.progress);else{let l=new Image;l.src=e,n.drawImage(l,nugget.element.timeline[t].location.x,nugget.element.timeline[t].location.y,nugget.element.timeline[t].width,nugget.element.timeline[t].height)}}let l=document.getElementById("split_inner_bottom");l.scrollWidth-l.offsetWidth<=nugget.element.player.progress+1&&null!=a.mediaRecorder&&a.mediaRecorder.stop()},clear:function(e){preview.width=preview.width},export:function(){let e=[];return new Promise((function(t,n){let l=preview.captureStream(60);a.mediaRecorder=new MediaRecorder(l,{mimeType:"video/webm; codecs=vp9"}),a.mediaRecorder.start(0),a.mediaRecorder.ondataavailable=function(t){e.push(event.data)},a.mediaRecorder.onstop=function(n){let l=new Blob(e,{type:"video/webm"}),i=URL.createObjectURL(l);t({url:i,blobVideo:l}),exportVideo.src=i,exportVideoModal.show()},nugget.element.player.start(),a.render()}))}},s={preview:a},u={nowDirectory:"",loadFile:function(e,t){document.querySelector("#assetBrowser").insertAdjacentHTML("beforeend",`\n            <div class="col-6 d-flex flex-column bd-highlight overflow-hidden asset mt-1" onclick="nugget.asset.add('${t}/${e}', '${t}')">\n                <i class="fas fa-file icon-lg align-self-center"></i>\n                <b class="align-self-center text-light">${e}</b>\n            </div>`)},loadFolder:function(e,t){document.querySelector("#assetBrowser").insertAdjacentHTML("beforeend",`\n            <div class="col-6 d-flex flex-column bd-highlight overflow-hidden asset mt-1" onclick="ipc.requestAllDir('${t}/${e}')">\n                <i class="fas fa-folder icon-lg align-self-center"></i>\n                <b class="align-self-center text-light">${e}</b>\n            </div>`)},loadPrevDirectory:function(){let e=u.nowDirectory.split("/"),t=e.slice(-e.length,-1);ipc.requestAllDir(t.join("/"))},add:function(e,t){fetch(`file://${e}`).then((e=>e.blob())).then((t=>{let n=URL.createObjectURL(t);nugget.element.bar.append(n),nugget.element.control.upload.image(n,e)}))}},m=u;nugget=t})();