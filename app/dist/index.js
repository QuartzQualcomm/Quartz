var nugget;(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{asset:()=>f,canvas:()=>v,element:()=>g});const n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let i;const s=new Uint8Array(16);function o(){if(!i&&(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(s)}const r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));const l=function(e,t,i){if(n.randomUUID&&!t&&!e)return n.randomUUID();const s=(e=e||{}).random||(e.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=s[e];return t}return function(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}(s)},a={},d={},c={scroller:void 0,isPaused:!0,progress:split_inner_bottom.scrollLeft,start:function(){let e=document.querySelector("#playToggle");e.setAttribute("onclick","nugget.element.player.stop()"),e.innerHTML='<span class="material-symbols-outlined icon-white icon-md"> stop_circle </span>',c.scroller=setInterval((function(){let e=Number(timeline_bar.style.left.split("px")[0])+4;timeline_bar.style.left=`${e}px`,c.progress=e,split_inner_bottom.innerWidth+split_inner_bottom.offsetWidth>=split_inner_bottom.offsetWidth&&c.stop(),p.play()}),20),c.isPaused=!1},stop:function(){clearInterval(c.scroller),c.isPaused=!0;let e=document.querySelector("#playToggle");e.setAttribute("onclick","nugget.element.player.start()"),e.innerHTML='<span class="material-symbols-outlined icon-white icon-md"> play_circle </span>',p.pauseAllVideo()},reset:function(){timeline_bar.style.left="0px",c.progress=0,c.isPaused=!0}},u={state:{isDrag:!1,isResize:!1,resizeLocation:"left",resizeRangeLeft:0,resizeRangeRight:0,e:void 0,blob:"",elementId:"",criteria:{x:0,y:0,duration:1e3},criteriaResize:{x:0,y:0}},event:{drag:{onmousedown:function(e){u.state.elementId=e.getAttribute("value"),u.state.isDrag=!0,u.state.e=e,u.state.criteria.x=valueEvent.mouse.x-Number(u.state.e.style.left.replace(/[^0-9]/g,"")),u.state.criteria.y=valueEvent.mouse.y},onmouseup:function(e){u.state.isDrag=!1}},resize:{onmousedownrange:function(e,t="left"){u.state.e=e.parentNode.parentNode,u.state.elementId=u.state.e.getAttribute("value"),u.state.isResize=!0,u.state.resizeLocation=t,u.state.isDrag=!1,u.state.criteria.duration=a[u.state.elementId].duration+Number(u.state.e.style.left.replace(/[^0-9]/g,"")),u.state.criteriaResize.x=Number(u.state.e.style.left.replace(/[^0-9]/g,"")),u.state.resizeRangeLeft=Number(u.state.e.querySelector(".element-bar-hiddenspace-left").style.width.split("px")[0]),u.state.resizeRangeRight=Number(u.state.e.querySelector(".element-bar-hiddenspace-right").style.width.split("px")[0])},onmousedown:function(e,t="left"){u.state.elementId=e.parentNode.getAttribute("value"),u.state.isResize=!0,u.state.resizeLocation=t,u.state.isDrag=!1,u.state.e=e.parentNode,u.state.criteriaResize.x="left"==t?valueEvent.mouse.x-Number(u.state.e.style.left.replace(/[^0-9]/g,"")):Number(u.state.e.style.left.replace(/[^0-9]/g,"")),u.state.criteriaResize.y=valueEvent.mouse.y,u.state.criteria.duration=a[u.state.elementId].duration+Number(u.state.e.style.left.replace(/[^0-9]/g,""))},onmouseup:function(e){u.state.isResize=!1}}},append:function(e){let t,n=document.querySelector("#split_inner_bottom"),i=a[e].duration,s=a[e].filetype,o=a[e].localpath.split("/"),r=o[o.length-1],l=u.getRandomColor();"video"==s&&(t=`<div class="element-bar" style="width: ${i}px; left: 0px; background-color: ${l};" onmousedown="nugget.element.bar.event.drag.onmousedown(this)" value="${e}">\n            ${r}\n            <div class="element-bar-hiddenspace-left position-absolute">\n                <div class="element-bar-resize-hiddenspace-left position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedownrange(this, 'left')">\n                </div>\n            </div>\n            <div class="element-bar-hiddenspace-right position-absolute">\n                <div class="element-bar-resize-hiddenspace-right position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedownrange(this, 'right')">\n                </div>\n            </div>\n            </div>`);let d="video"!=s?`<div class="element-bar" style="width: ${i}px; left: 0px; background-color: ${l};" onmousedown="nugget.element.bar.event.drag.onmousedown(this)" value="${e}">\n            ${r}\n            <div class="element-bar-resize-left position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedown(this, 'left')"></div>\n            <div class="element-bar-resize-right position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedown(this, 'right')"></div>\n            </div>`:t;n.insertAdjacentHTML("beforeend",d)},drag:function(e,t){let n=u.state.elementId;u.state.e.style.left=`${e}px`,a[n].startTime=e},resizeDurationInTimeline:function(e,t="left"){let n=u.state.elementId,i=u.state.criteria.duration;"left"==t?(u.state.e.style.left=`${e}px`,u.state.e.style.width=i-e+"px",a[n].startTime=e,a[n].duration=Number(u.state.e.style.width.split("px")[0])):(u.state.e.style.left=`${u.state.criteriaResize.x}px`,u.state.e.style.width=split_inner_bottom.scrollLeft+valueEvent.mouse.x-u.state.criteriaResize.x+"px",a[n].startTime=u.state.criteriaResize.x,a[n].duration=Number(u.state.e.style.width.split("px")[0]))},resizeRangeOnElement:function(e,t="left"){let n=u.state.elementId,i=u.state.criteria.duration,s=Number(u.state.e.style.width.split("px")[0]),o=(u.state.resizeRangeLeft,u.state.resizeRangeRight,u.state.e.querySelector(".element-bar-hiddenspace-left")),r=u.state.e.querySelector(".element-bar-hiddenspace-right"),l=window.innerWidth,d=split_inner_bottom.scrollWidth,c=Number(u.state.e.style.left.split("px")[0]),m=d-l-split_inner_bottom.scrollLeft,p=l-s-c>0?l-s-c-10:0;"left"==t?(o.style.width=e+split_inner_bottom.scrollLeft-5+"px",a[n].trim.startTime=Number(o.style.width.split("px")[0])):(r.style.width=m+window.innerWidth-e-u.state.criteriaResize.x-p+"px",a[n].trim.endTime=i-Number(r.style.width.split("px")[0]))},getRandomColor:function(){return"#"+Math.round(16777215*Math.random()).toString(16)+"51"}},m={state:{activeElementId:"",isDrag:!1,isResize:!1,e:void 0,elementId:"",criteriaDrag:{x:0,y:0},criteriaResize:{x:0,y:0,w:0,h:0},resizeDirection:"",resizeTargetElementId:""},event:{click:{activateOutline:function(e){m.event.click.deactivateAllOutline(),m.state.activeElementId=e,document.querySelector(`#element-${e}`).classList.add("element-outline")},deactivateAllOutline:function(){console.log("S");for(const e in a)Object.hasOwnProperty.call(a,e)&&document.querySelector(`#element-${e}`).classList.remove("element-outline");m.state.activeElementId=""}},drag:{onmousedown:function(e){m.event.click.activateOutline(e.id.split("element-")[1]),m.state.isDrag=!0,m.state.e=e,m.state.criteriaDrag.x=valueEvent.mouse.x-Number(m.state.e.style.left.replace(/[^0-9]/g,"")),m.state.criteriaDrag.y=valueEvent.mouse.y-Number(m.state.e.style.top.replace(/[^0-9]/g,""))},onmouseup:function(e){m.state.isDrag=!1}},resize:{onmousedown:function(e,t="n"){let n=document.querySelector(`#element-${e}`);m.state.isDrag=!1,m.state.criteriaResize.w=Number(n.style.width.split("px")[0]),m.state.criteriaResize.h=Number(n.style.height.split("px")[0]),m.state.criteriaResize.x=Number(n.style.left.split("px")[0]),m.state.criteriaResize.y=Number(n.style.top.split("px")[0]),m.state.isResize=!0,m.state.resizeTargetElementId=e,m.state.resizeDirection=t}},textinput:{onkeyup:function(e){let t=document.querySelector(`#element-${e}`).querySelector("input").value;console.log(e,t),a[e].text=t}}},add:{image:function(e,t){let n=document.createElement("img"),i=m.generateUUID();n.src=e,n.onload=function(){var s=n.width/10,o=n.height/10;a[i]={startTime:0,duration:1e3,location:{x:0,y:0},width:s,height:o,localpath:t,filetype:"image"},d[i]={blob:e},p.show.image(i),u.append(i)}},video:function(e,t){let n=document.createElement("video"),i=m.generateUUID();n.src=e,n.preload="metadata",n.onloadedmetadata=function(){let s=n.videoWidth/10,o=n.videoHeight/10,r=200*n.duration;a[i]={startTime:0,duration:r,location:{x:0,y:0},trim:{startTime:0,endTime:r},width:s,height:o,localpath:t,filetype:"video"},d[i]={blob:e},p.show.video(i),u.append(i)}},text:function(){let e=m.generateUUID();a[e]={startTime:0,duration:1e3,text:"텍스트",location:{x:0,y:0},localpath:"/TESTELEMENT",filetype:"text"},p.show.text(e),u.append(e)}},drag:function(e,t){let n=m.state.e,i=["img","video","input"],s="";for(let e=0;e<i.length;e++)n.querySelector(i[e])&&(s=i[e]);let o=n.querySelector(s).parentNode.getAttribute("id").split("element-")[1];n.style.top=`${t}px`,n.style.left=`${e}px`,a[o].location.x=e,a[o].location.y=t},dragover:function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){e.stopPropagation(),e.preventDefault()},onmouseup:function(e){m.state.isResize=!1,m.state.isDrag=!1;for(const e in a)Object.hasOwnProperty.call(a,e)&&document.querySelector(`#element-${e}`)},generateUUID:function(){return l()},resize:{action:function(e,t){m.state.isDrag=!1;let n=m.state.resizeTargetElementId,i=document.querySelector(`#element-${n}`);switch(m.state.resizeDirection){case"n":i.style.top=`${m.state.criteriaResize.y+t}px`,i.style.height=m.state.criteriaResize.h-t+"px";break;case"s":i.style.top=`${m.state.criteriaResize.y}px`,i.style.height=`${t}px`;break;case"w":i.style.left=`${m.state.criteriaResize.x+e}px`,i.style.width=m.state.criteriaResize.w-e+"px";break;case"e":i.style.left=`${m.state.criteriaResize.x}px`,i.style.width=`${e}px`}a[n].location.y=Number(i.style.top.split("px")[0]),a[n].location.x=Number(i.style.left.split("px")[0]),a[n].width=Number(i.style.width.split("px")[0]),a[n].height=Number(i.style.height.split("px")[0])}}},p={previewRatio:1920/preview.width,show:{image:function(e){let t=d[e].blob;null==document.getElementById(`element-${e}`)?control.insertAdjacentHTML("beforeend",`\n                <div id="element-${e}" class="element-drag" style='width: ${a[e].width}px; height: ${a[e].height}px; top: 0px; left: 0px;' onmousedown="nugget.element.control.event.drag.onmousedown(this)" onclick="nugget.element.control.event.click.activateOutline('${e}')">\n                <img src="${t}" alt="" class="element-image" draggable="false">\n                <div class="resize-n" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'n')"></div>\n                <div class="resize-s" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 's')"></div>\n                <div class="resize-w" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'w')"></div>\n                <div class="resize-e" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'e')"></div>\n    \n                </div>\n                `):document.querySelector(`#element-${e}`).classList.remove("d-none")},video:function(e){let t=d[e].blob;if(null==document.getElementById(`element-${e}`)){control.insertAdjacentHTML("beforeend",`\n                <div id="element-${e}" class="element-drag" style='width: ${a[e].width}px; height: ${a[e].height}px; top: 0px; left: 0px;' onmousedown="nugget.element.control.event.drag.onmousedown(this)" onclick="nugget.element.control.event.click.activateOutline('${e}')">\n                <video src="${t}" alt="" class="element-video" draggable="false"></video>\n                <div class="resize-n" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'n')"></div>\n                <div class="resize-s" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 's')"></div>\n                <div class="resize-w" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'w')"></div>\n                <div class="resize-e" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'e')"></div>\n    \n                </div>\n                `);let n=document.getElementById(`element-${e}`).querySelector("video"),i=(a[e].startTime-c.progress)/200;n.currentTime=i}else{let t=document.getElementById(`element-${e}`).querySelector("video"),n=-(a[e].startTime-c.progress)/200;t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2?(c.isPaused&&console.log("paused"),console.log("isPlaying")):(t.currentTime=n,t.play()),document.querySelector(`#element-${e}`).classList.remove("d-none")}},text:function(e){null==document.getElementById(`element-${e}`)?control.insertAdjacentHTML("beforeend",`\n                <div id="element-${e}" class="element-drag" style='top: 0px; left: 0px;' onmousedown="nugget.element.control.event.drag.onmousedown(this)" onclick="nugget.element.control.event.click.activateOutline('${e}')">\n                <input type="text" class="form-transparent element-text" draggable="false" onkeyup="nugget.element.control.event.textinput.onkeyup('${e}')" value="텍스트">\n                <div class="resize-n" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'n')"></div>\n                <div class="resize-s" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 's')"></div>\n                <div class="resize-w" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'w')"></div>\n                <div class="resize-e" onmousedown="nugget.element.control.event.resize.onmousedown('${e}', 'e')"></div>\n    \n                </div>\n                `):document.querySelector(`#element-${e}`).classList.remove("d-none")}},hide:function(e){"video"==a[e].filetype&&p.pauseVideo(e),document.querySelector(`#element-${e}`).classList.add("d-none")},play:function(){let e;for(e in a){location.origin,d[e];let t=a[e].filetype,n=a[e].startTime>c.progress||a[e].startTime+a[e].duration<c.progress;"video"==t&&(n=a[e].startTime+a[e].trim.startTime>c.progress||a[e].startTime+a[e].trim.endTime<c.progress),n?p.hide(e):p.show[t](e)}},pauseVideo:function(e){document.getElementById(`element-${e}`).querySelector("video").pause()},pauseAllVideo:function(){let e;for(e in a)"video"==a[e].filetype&&document.getElementById(`element-${e}`).querySelector("video").pause()}},g={timeline:a,player:c,bar:u,control:m,preview:p},h={mediaRecorder:void 0,resize:function(){let e=document.getElementById("split_col_2").offsetWidth,t=(document.getElementById("split_col_2").offsetHeight,.95*e),n=9*t/16;preview.width=t,preview.height=n,preview.style.width=`${t}px`,preview.style.height=`${n}px`,video.style.width=`${t}px`,video.style.height=`${n}px`,nugget.element.preview.previewRatio=1920/t},render:function(e){let t,n=e.getContext("2d");for(t in preview.clear(),nugget.element.timeline){let e=`blob:${location.origin}/${t}`;if(nugget.element.timeline[t].startTime>nugget.element.player.progress||nugget.element.timeline[t].startTime+nugget.element.timeline[t].duration<nugget.element.player.progress);else{let i=new Image;i.src=e,n.drawImage(i,nugget.element.timeline[t].location.x,nugget.element.timeline[t].location.y,nugget.element.timeline[t].width,nugget.element.timeline[t].height)}}let i=document.getElementById("split_inner_bottom");i.scrollWidth-i.offsetWidth<=nugget.element.player.progress+1&&null!=h.mediaRecorder&&h.mediaRecorder.stop()},clear:function(e){preview.width=preview.width},export:function(){let e=[];return new Promise((function(t,n){let i=preview.captureStream(60);h.mediaRecorder=new MediaRecorder(i,{mimeType:"video/webm; codecs=vp9"}),h.mediaRecorder.start(0),h.mediaRecorder.ondataavailable=function(t){e.push(event.data)},h.mediaRecorder.onstop=function(n){let i=new Blob(e,{type:"video/webm"}),s=URL.createObjectURL(i);t({url:s,blobVideo:i}),exportVideo.src=s,exportVideoModal.show()},nugget.element.player.start(),h.render()}))}},v={preview:h},y={nowDirectory:"",loadPrevDirectory:function(){let e=y.nowDirectory.split("/"),t=e.slice(-e.length,-1);ipc.requestAllDir(t.join("/"))},add:function(e,t){fetch(`file://${e}`).then((e=>e.blob())).then((t=>{let n=URL.createObjectURL(t),i=t.type.split("/")[0];nugget.element.control.add[i](n,e)}))}},f=y;class b extends HTMLElement{constructor(){super(),this.nowDirectory=""}render(){const e=this.template();this.innerHTML=e}template(){return'<div class="row px-2"></div>'}getFile(e){let t=e.split("."),n=t.length;n<=2||t[n-1],this.querySelector("div").insertAdjacentHTML("beforeend",`<asset-file asset-name="${e}"></asset-file>`)}getFolder(e){let t=e.split(".").length;t<=2||splitedFilename[t-1],this.querySelector("div").insertAdjacentHTML("beforeend",`<asset-folder asset-name="${e}"></asset-folder>`)}clearList(){this.querySelector("div").innerHTML=""}connectedCallback(){this.render()}}class w extends HTMLElement{constructor(){super(),this.classList.add("col-4","d-flex","flex-column","bd-highlight","overflow-hidden","mt-1","asset"),this.filename=this.getAttribute("asset-name"),this.directory=document.querySelector("asset-list").nowDirectory}render(){const e=this.template();this.innerHTML=e}template(){return`<span class="material-symbols-outlined icon-lg align-self-center"> draft </span>\n        <b class="align-self-center text-ellipsis-scroll text-light text-center">${this.filename}</b>`}handleClick(){nugget.asset.add(`${this.directory}/${this.filename}`,`${this.directory}`)}connectedCallback(){this.render(),this.addEventListener("click",this.handleClick.bind(this))}disconnectedCallback(){this.removeEventListener("click",this.handleClick)}}class x extends HTMLElement{constructor(){super(),this.classList.add("col-4","d-flex","flex-column","bd-highlight","overflow-hidden","mt-1","asset"),this.foldername=this.getAttribute("asset-name"),this.directory=document.querySelector("asset-list").nowDirectory}render(){const e=this.template();this.innerHTML=e}template(){return`<span class="material-symbols-outlined icon-lg align-self-center"> folder </span>\n        <b class="align-self-center text-ellipsis text-light text-center">${this.foldername}</b>`}handleClick(){ipc.requestAllDir(`${this.directory}/${this.foldername}`)}connectedCallback(){this.render(),this.addEventListener("click",this.handleClick.bind(this))}disconnectedCallback(){this.removeEventListener("click",this.handleClick)}}class z extends HTMLElement{constructor(){super(),this.directory=""}render(){const e=this.template();this.innerHTML=e}template(){return'<div class="row p-0 mt-2">\n        <div class="col-2">\n            <button class="btn btn-transparent btn-sm"><span class="material-symbols-outlined icon-sm"> arrow_upward </span> </button>\n        </div>\n\n        <div class="col-10">\n            <input type="text" class="form-control" aria-describedby="basic-addon1" value="" disabled>\n        </div>\n\n    </div>'}updateDirectoryInput(e){this.querySelector("div").querySelectorAll("div")[1].querySelector("input").value=e}clickPrevDirectoryButton(){this.directory=document.querySelector("asset-list").nowDirectory;let e=this.directory.split("/"),t=e.slice(-e.length,-1);ipc.requestAllDir(t.join("/"))}connectedCallback(){this.render(),this.querySelector("div").querySelectorAll("div")[0].querySelector("button").addEventListener("click",this.clickPrevDirectoryButton.bind(this))}disconnectedCallback(){this.querySelector("div").querySelectorAll("div")[0].querySelector("button").removeEventListener("click",this.clickPrevDirectoryButton)}}customElements.define("asset-list",b),customElements.define("asset-file",w),customElements.define("asset-folder",x),customElements.define("asset-browser",z),nugget=t})();