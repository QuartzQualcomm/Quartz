var NUGGET;(()=>{"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{asset:()=>n,directory:()=>s,fonts:()=>m,mime:()=>l,project:()=>r,renderAnimation:()=>h});const i={nowDirectory:"",loadPrevDirectory:function(){let e=i.nowDirectory.split("/"),t=e.slice(-e.length,-1);ipc.requestAllDir(t.join("/"))},add:function(e){fetch(`file://${e}`).then((e=>e.blob())).then((t=>{let i=URL.createObjectURL(t),n=t.type.split("/")[0],s=document.querySelector("element-control");"image"==n?s.addImage(i,e):"video"==n?s.addVideo(i,e):"audio"==n&&s.addAudio(i,e)}))}},n=i,s={select:function(){const e=document.querySelector("#projectFolder");window.electronAPI.req.dialog.openDirectory().then((t=>{e.value=t||"/",window.electronAPI.req.filesystem.getAllDirectory(String(e.value))}))}},l={mimeArray:{png:{type:"image"},jpg:{type:"image"},jpeg:{type:"image"},gif:{type:"image"},mp4:{type:"video"},mov:{type:"video"},avi:{type:"video"},wmv:{type:"video"},mpg:{type:"video"},mkv:{type:"video"},webm:{type:"video"},mp3:{type:"audio"},wav:{type:"audio"}},lookup:function(e){const t=e.split(".");return t.length<=1?{type:"unknown"}:this.mimeArray[t[t.length-1]]?{type:this.mimeArray[t[t.length-1]].type}:{type:"unknown"}}},o={save:function(){const e=document.querySelector("#projectFile").value;if(console.log(e),""!=e)return o.saveProjectFile({projectDestination:e}),0;window.electronAPI.req.project.save().then((e=>{let t=e||"nonefile";if("nonefile"==t)return 0;o.saveProjectFile({projectDestination:t})}))},load:function(){new JSZip;const e=document.querySelector("element-timeline");if(1==e.isTimelineChange())return rendererModal.whenTimelineChanged.show(),document.querySelector("#whenTimelineChangedMsg").innerHTML="새 프로젝트 파일을 볼러오려면 에디터를 닫고 재실행해 주세요.",0;const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",".ngt"),t.click(),t.addEventListener("change",(function(){e.resetTimelineData();let t=this.files[0].path;window.electronAPI.req.filesystem.readFile(t).then((i=>{JSZip.loadAsync(i).then((function(i){i.file("timeline.json").async("string").then((async i=>{let n=JSON.parse(i);await e.patchTimeline(n),o.changeProjectFileValue({projectDestination:t})}))}))}))}),!1)},saveProjectFile:function({projectDestination:e}){const t=document.querySelector("element-timeline"),i=document.querySelector("element-timeline").timeline,n=Number(document.querySelector("#projectDuration").value),s=document.querySelector("element-control").previewRatio,l=new JSZip,r={videoDuration:n,previewRatio:s,videoDestination:e};l.file("timeline.json",JSON.stringify(i)),l.file("renderOptions.json",JSON.stringify(r)),l.generateAsync({type:"blob"}).then((async function(i){const n=(e=>{for(var t="",i=new Uint8Array(e),n=i.byteLength,s=0;s<n;s++)t+=String.fromCharCode(i[s]);return window.btoa(t)})(await i.arrayBuffer());window.electronAPI.req.filesystem.writeFile(e,n,"base64").then((i=>{console.log("saved!"),bootstrap.Toast.getInstance(document.getElementById("saveProject")).show(),t.appendCheckpointInHashTable(),o.changeProjectFileValue({projectDestination:e})}))}))},changeProjectFileValue:function({projectDestination:e}){document.querySelector("#projectFile").value=e,document.querySelector("title").innerHTML=`Nugget - ${e}`}},r=o,a=function(e){rendererUtil.showProgressModal(),document.querySelector("#progress").style.width=`${e}%`,document.querySelector("#progress").innerHTML=`${Math.round(e)}%`},d={state:{animateElements:{},elements:void 0,options:void 0,numberOfRenderingRequired:0,renderingCount:0,renderingProgress:0},initAnimateElementState:function(e){let t=document.createElement("canvas");t.classList.add("d-none"),t.setAttribute("width","1920"),t.setAttribute("height","1080");let i=t.getContext("2d");d.state.animateElements[e]={renderFrameLength:0,savedFrameCount:0,isCombineFrames:!1,canvas:t,context:i}},render:function(e,t){console.log(e),d.state.elements=e,d.state.options=t,d.state.numberOfRenderingRequired=0;let i=`${t.videoDestinationFolder}/renderAnimation`;window.electronAPI.req.filesystem.mkdir(i,{recursive:!0}).then((t=>{a(0),window.electronAPI.req.filesystem.emptyDirSync(i);for(const t in e)if(Object.hasOwnProperty.call(e,t)){const n=e[t];if(0==n.hasOwnProperty("animation"))continue;if("image"!==n.filetype)continue;if(1==n.animation.position.isActivate){d.initAnimateElementState(t),d.state.numberOfRenderingRequired+=1;let e=d.renderFrame({elementId:t,elements:n});for(let n=0;n<e.length;n++)d.saveFrame({elementId:t,data:e[n],outputDir:i,frame:n})}}0==d.state.numberOfRenderingRequired&&d.renderOutput()}))},renderFrame:function({elementId:e,elements:t}){let i=d.state.animateElements[e].canvas,n=d.state.animateElements[e].context,s=t.animation.position.allpoints,l=[];d.state.animateElements[e].renderFrameLength=s[0].length;for(let t=0;t<s[0].length;t++){n.clearRect(0,0,i.width,i.height);let o={x:s[0][t].y,y:t<s[1].length?s[1][t].y:s[1][s[1].length-1].y};d.drawImage(e,n,o),n.stroke(),l.push(i.toDataURL("image/png"))}return l},drawImage:function(e,t,i){let n=document.querySelector(`element-control-asset[element-id='${e}']`).querySelector("img"),s=0+i.x,l=i.y,o=d.state.elements[e].width,r=d.state.elements[e].height;t.drawImage(n,s,l,o,r)},saveFrame:function({data:e,outputDir:t,frame:i,elementId:n}){const s=e.substring("data:image/png;base64,".length),l=`${t}/frame-${n}-${String(i+1).padStart(4,"0")}.png`;window.electronAPI.req.filesystem.writeFile(l,s,"base64").then((e=>{d.state.animateElements[n].savedFrameCount+=1,d.state.animateElements[n].savedFrameCount>=d.state.animateElements[n].renderFrameLength&&0==d.state.animateElements[n].isCombineFrames&&(d.state.animateElements[n].isCombineFrames,d.combineFrame({elementId:n,outputDir:t}))}))},combineFrame:function({elementId:e,outputDir:t}){let i=`${t}/${e}.webm`;window.electronAPI.req.ffmpeg.combineFrame(t,e),window.electronAPI.res.render.finishCombineFrame(((t,n)=>{if(n!=e)return 0;d.state.elements[e].filetype="video",d.state.elements[e].isExistAudio=!1,d.state.elements[e].localpath=i,d.state.elements[e].trim={startTime:0,endTime:d.state.elements[e].duration},d.state.elements[e].height=1080,d.state.elements[e].width=1920,d.state.elements[e].location={x:0,y:50},d.state.elements[e].codec={video:"libvpx-vp9",audio:"default"},d.state.renderingCount+=1,d.state.renderingProgress=d.state.renderingCount/d.state.numberOfRenderingRequired*100,a(d.state.renderingProgress),d.state.renderingCount>=d.state.numberOfRenderingRequired&&d.renderOutput()}))},renderOutput:function(){console.log("REND processing"),window.electronAPI.req.render.outputVideo(d.state.elements,d.state.options)}},h=d,m={get:async function(){window.electronAPI.req.font.getLists().then((e=>{if(0==e.status)return 0;console.log(e)}))}};class c extends HTMLElement{constructor(){super(),this.blobThumbnail={},this.nowDirectory=""}render(){const e=this.template();this.innerHTML=e}template(){return'<div class="row px-2"> <p class="text-light mt-2 text-center">프로젝트 폴더를 지정한 후 표시됩니다.</p> </div>'}getFile(e){let t=e.split("."),i=t.length;i<=2||t[i-1],this.querySelector("div").insertAdjacentHTML("beforeend",`<asset-file asset-name="${e}"></asset-file>`)}getFolder(e){let t=e.split(".").length;t<=2||splitedFilename[t-1],this.querySelector("div").insertAdjacentHTML("beforeend",`<asset-folder asset-name="${e}"></asset-folder>`)}clearList(){this.querySelector("div").innerHTML=""}connectedCallback(){this.render()}}class u extends HTMLElement{constructor(){super(),this.classList.add("col-4","d-flex","flex-column","bd-highlight","overflow-hidden","mt-1","asset"),this.filename=this.getAttribute("asset-name"),this.directory=document.querySelector("asset-list").nowDirectory}async render(){const e=NUGGET.mime.lookup(this.filename).type,t=`file://${this.directory}/${this.filename}`,i=document.querySelector("asset-list");let n;if("image"==e)n=this.templateImage(t);else if("video"==e)if(i.blobThumbnail.hasOwnProperty(t)){let e=i.blobThumbnail[t];n=this.templateVideoThumbnail(e)}else{let e=await this.captureVideoThumbnail(t);i.blobThumbnail[t]=e,n=this.templateVideoThumbnail(e)}else n=this.template(e);this.innerHTML=n}template(e="unknown"){return`<span class="material-symbols-outlined icon-lg align-self-center"> ${{video:"video_file",audio:"audio_file",unknown:"draft"}[e]} </span>\n        <b class="align-self-center text-ellipsis-scroll text-light text-center">${this.filename}</b>`}templateImage(e){return`<img src="${e}" alt="" class="align-self-center asset-preview">\n        <b class="align-self-center text-ellipsis-scroll text-light text-center">${this.filename}</b>`}templateVideoThumbnail(e){return`\n        <div class="position-relative align-self-center">\n        <img src="${e}" alt="" class="align-self-center asset-preview w-100">\n        <span class="material-symbols-outlined position-absolute icon-center ">\n        play_arrow\n        </span>\n        </div>\n        \n        <b class="align-self-center text-ellipsis-scroll text-light text-center">${this.filename}</b>`}handleClick(){NUGGET.asset.add(`${this.directory}/${this.filename}`)}async captureVideoThumbnail(e){return await new Promise(((t,i)=>{fetch(`${e}`).then((e=>e.blob())).then((e=>{const i=URL.createObjectURL(e),n=document.createElement("video");n.src=i,n.preload="metadata",n.onloadedmetadata=async()=>{const e=document.createElement("canvas");n.addEventListener("seeked",(()=>{let i=n.videoWidth,s=n.videoHeight;e.width=i,e.height=s,e.getContext("2d").drawImage(n,0,0,e.width,e.height),e.toBlob((e=>{const i=document.createElement("img"),n=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(n)},t(n)}))})),n.currentTime=1}}))}))}async connectedCallback(){await this.render(),this.addEventListener("click",this.handleClick.bind(this))}disconnectedCallback(){this.removeEventListener("click",this.handleClick)}}class p extends HTMLElement{constructor(){super(),this.classList.add("col-4","d-flex","flex-column","bd-highlight","overflow-hidden","mt-1","asset"),this.foldername=this.getAttribute("asset-name"),this.directory=document.querySelector("asset-list").nowDirectory}render(){const e=this.template();this.innerHTML=e}template(){return`<span class="material-symbols-outlined icon-lg align-self-center"> folder </span>\n        <b class="align-self-center text-ellipsis text-light text-center">${this.foldername}</b>`}handleClick(){ipc.requestAllDir(`${this.directory}/${this.foldername}`)}connectedCallback(){this.render(),this.addEventListener("click",this.handleClick.bind(this))}disconnectedCallback(){this.removeEventListener("click",this.handleClick)}}class y extends HTMLElement{constructor(){super(),this.directory=""}render(){const e=this.template();this.innerHTML=e}template(){return'<div class="row p-0 mt-2">\n        <div class="col-2">\n            <button class="btn btn-transparent btn-sm"><span class="material-symbols-outlined icon-sm"> arrow_upward </span> </button>\n        </div>\n        <div class="col-10">\n            <input type="text" class="form-control" aria-describedby="basic-addon1" value="" disabled>\n        </div>\n        </div>'}updateDirectoryInput(e){this.querySelector("div").querySelectorAll("div")[1].querySelector("input").value=e}clickPrevDirectoryButton(){if(this.directory=document.querySelector("asset-list").nowDirectory,""==this.directory)return 0;let e=this.directory.split("/"),t=e.slice(-e.length,-1);ipc.requestAllDir(t.join("/"))}connectedCallback(){this.render(),this.querySelector("div").querySelectorAll("div")[0].querySelector("button").addEventListener("click",this.clickPrevDirectoryButton.bind(this))}disconnectedCallback(){this.querySelector("div").querySelectorAll("div")[0].querySelector("button").removeEventListener("click",this.clickPrevDirectoryButton)}}class g extends HTMLElement{constructor(){super()}render(){const e=this.template();this.classList.add("bg-dark","position-absolute","d-none"),this.style.left="0px",this.style.top="0px",this.style.width="100%",this.style.height="100%",this.style.zIndex="10000",this.style.opacity="80%",this.style.paddingTop="46vh",this.innerHTML=e}template(){return'\n        <div class="row justify-content-center align-items-start">\n            <b class="col-12 align-self-center text-light position-fixed text-center">\n                여기에 파일을 드롭해주세요\n            </b>\n        </div>'}handleDragEnter(){this.classList.remove("d-none")}handleDragOver(e){e.preventDefault(),this.classList.remove("d-none")}handleDragLeave(){this.classList.add("d-none")}handleDrop(e){e.preventDefault();try{let t=e.dataTransfer.files[0].path;NUGGET.asset.add(t),this.classList.add("d-none")}catch(e){setTimeout((()=>{this.classList.add("d-none")}),800)}}connectedCallback(){this.render(),document.addEventListener("dragenter",this.handleDragEnter.bind(this)),document.addEventListener("dragover",this.handleDragOver.bind(this)),this.addEventListener("dragleave",this.handleDragLeave.bind(this)),this.addEventListener("drop",this.handleDrop.bind(this))}disconnectedCallback(){}}const v={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let f;const b=new Uint8Array(16);function w(){if(!f&&(f="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!f))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(b)}const T=[];for(let e=0;e<256;++e)T.push((e+256).toString(16).slice(1));const x=function(e,t,i){if(v.randomUUID&&!t&&!e)return v.randomUUID();const n=(e=e||{}).random||(e.rng||w)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=n[e];return t}return function(e,t=0){return(T[e[t+0]]+T[e[t+1]]+T[e[t+2]]+T[e[t+3]]+"-"+T[e[t+4]]+T[e[t+5]]+"-"+T[e[t+6]]+T[e[t+7]]+"-"+T[e[t+8]]+T[e[t+9]]+"-"+T[e[t+10]]+T[e[t+11]]+T[e[t+12]]+T[e[t+13]]+T[e[t+14]]+T[e[t+15]]).toLowerCase()}(n)};class S extends HTMLElement{constructor(){super(),this.elementControl,window.addEventListener("DOMContentLoaded",(()=>{this.elementControl=document.querySelector("element-control")})),this.timeline={},this.timelineHashTable={},this.appendCheckpointInHashTable(),this.copyedTimelineData={},this.editGuideBreakPoint=[]}generateHash(e){let t,i,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)i=e.charCodeAt(t),n=(n<<5)-n+i,n|=0;return n}getTime(){return Date.now()}appendCheckpointInHashTable(){let e=JSON.stringify(this.timeline),t=this.generateHash(e),i=this.getTime();this.timelineHashTable[i]=t}isTimelineChange(){let e=JSON.stringify(this.timeline),t=this.generateHash(e),i=Object.keys(this.timelineHashTable).length,n=Object.keys(this.timelineHashTable)[i-1];return t!=this.timelineHashTable[n]}render(){const e=this.template();this.classList.add("col-12","cursor-default","h-100","line","bg-darker"),this.innerHTML=e}template(){return'\n        <element-timeline-ruler></element-timeline-ruler>\n        <element-timeline-cursor></element-timeline-cursor>\n        <div ref="elementLayer"></div>\n\n        '}replaceTimelineBarHeight(e){this.querySelector(".timeline-bar").style.height=`${e}px`}getTimelineScrollHeight(){return this.scrollHeight}async patchTimeline(e){this.timeline=e,this.elementControl.timeline=e;for(const t in e)if(Object.hasOwnProperty.call(e,t)){const i=e[t];this.patchElementInTimeline({elementId:t,element:i})}}async patchElementInTimeline({elementId:e,element:t}){if("image"==t.filetype){let i=await this.getBlobUrl(`file://${t.localpath}`);this.timeline[e].blob=String(i),this.elementControl.showImage(e)}else if("video"==t.filetype){let i=await this.getBlobUrl(`file://${t.localpath}`);this.timeline[e].blob=String(i),this.elementControl.showVideo(e)}else if("text"==t.filetype)this.elementControl.showText(e);else if("audio"==t.filetype){let i=await this.getBlobUrl(`file://${t.localpath}`);this.timeline[e].blob=String(i),this.elementControl.showAudio(e)}this.addElementBar(e)}resetTimelineData(){this.timeline={},this.removeAllTimelineBars(),this.elementControl.removeAllElementAsset()}removeAllTimelineBars(){this.querySelectorAll("element-bar").forEach((e=>{e.remove()}))}async getBlobUrl(e){try{const t=await fetch(e),i=await t.blob();return URL.createObjectURL(i)}catch(e){let t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsSAAALEgHS3X78AAAAM0lEQVQ4jWNkYGD4z4AEUDgMDAyMBASYGCgEowaMGjA4DGD8/x8j+dPXBSzka/1PHRcAAFzYCBvm7NkTAAAAAElFTkSuQmCC";console.error(e);const i=await fetch(t),n=await i.blob();return URL.createObjectURL(n)}}addElementBar(e){const t=this.templateElementBar(e);this.querySelector("div[ref='elementLayer']").insertAdjacentHTML("afterbegin",t)}templateElementBar(e){this.timeline[e].duration;let t=this.timeline[e].filetype,i=this.timeline[e].localpath.split("/"),n=(i[i.length-1],this.getElementType(t));return"static"==n?`\n            <element-bar element-id="${e}" element-type="static"></element-bar> \n\n            <animation-panel element-id="${e}"> \n                <animation-panel-item animation-type="position" element-id="${e}"></animation-panel-item> \n\n            </animation-panel> \n            `:"dynamic"==n?`<element-bar element-id="${e}" element-type="dynamic"></element-bar>`:"none"}getElementType(e){let t="undefined";const i={static:["image","text","png","jpg","jpeg"],dynamic:["video","audio","mp4","mp3","mov"]};for(const n in i)if(Object.hasOwnProperty.call(i,n)&&i[n].indexOf(e)>=0){t=n;break}return t}togglePlayer(){1==this.elementControl.isPaused?this.elementControl.play():this.elementControl.stop()}removeAnimationPanelById(e){let t=this.querySelector(`animation-panel[element-id="${e}"]`);if(!t)return 0;t.remove()}removeElementInTimelineData(e){delete this.timeline[e]}removeElementById(e){this.querySelector(`element-bar[element-id="${e}"]`).remove()}removeSeletedElements(){this.elementControl.selectElementsId.forEach((e=>{this.removeElementById(e),this.removeElementInTimelineData(e),this.removeAnimationPanelById(e),this.elementControl.removeElementById(e)})),this.elementControl.selectElementsId=[]}copySeletedElement(){let e={};this.elementControl.selectElementsId.forEach((t=>{let i=x();e[i]=this.timeline[t]})),this.copyedTimelineData=e}pasteElement({elementId:e,element:t}){this.timeline[e]=_.cloneDeep(t)}showAnimationPanel(e){this.querySelector(`animation-panel[element-id='${e}']`).show()}hideAnimationPanel(e){this.querySelector(`animation-panel[element-id='${e}']`).hide()}showKeyframeEditor(e,t){let i=new bootstrap.Offcanvas(document.getElementById("option_bottom")),n=document.querySelector("#timelineOptionBody"),s=document.querySelector("#timelineOptionTargetElement");n.innerHTML=`<keyframe-editor element-id="${e}" animation-type="${t}"></keyframe-editor>`,n.classList.remove("d-none"),s.value=e,i.show()}deactivateSeletedBar(){this.elementControl.selectElementsId.forEach((e=>{document.querySelector(`element-bar[element-id='${e}']`).unselectThisElement()}))}fixRulerOnTop(){const e=this.scrollTop,t=document.querySelector("element-timeline-ruler"),i=document.querySelector("element-timeline-cursor");t.setTopPosition(e),i.style.top=`${e}px`}scrollKeyframeEditor(){if(0==!!document.querySelector("keyframe-editor"))return 0;document.querySelector("keyframe-editor").scrollTo(this.scrollLeft,this.scrollTop)}handleKeydown(e){if(console.log("event keycode > ",e.keyCode),1==this.elementControl.existActiveElement)return 0;if(32==e.keyCode&&(e.preventDefault(),this.togglePlayer()),8==e.keyCode&&(e.preventDefault(),this.removeSeletedElements()),e.ctrlKey&&86==e.keyCode)for(const e in this.copyedTimelineData)Object.hasOwnProperty.call(this.copyedTimelineData,e)&&(this.pasteElement({elementId:e,element:this.copyedTimelineData[e]}),this.patchElementInTimeline({elementId:e,element:this.copyedTimelineData[e]}));e.ctrlKey&&67==e.keyCode&&this.copySeletedElement(),e.ctrlKey&&88==e.keyCode&&(this.copySeletedElement(),this.removeSeletedElements())}handleMousedown(){this.elementControl.deactivateAllOutline(),this.deactivateSeletedBar()}handleScroll(){this.fixRulerOnTop(),this.scrollKeyframeEditor()}connectedCallback(){this.render(),this.addEventListener("mousedown",this.handleMousedown.bind(this)),this.addEventListener("scroll",this.handleScroll.bind(this)),document.addEventListener("keydown",this.handleKeydown.bind(this))}}class E extends HTMLElement{constructor(){super(),this.elementTimelineRuler,window.addEventListener("DOMContentLoaded",(()=>{this.elementTimelineRuler=document.querySelector("element-timeline-ruler")}))}render(){this.classList.add("timeline-bar"),this.setAttribute("id","timeline_bar"),this.style.left="0px",this.style.top="0px"}move(e){this.style.left=`${e}px`}handleMousedown(e){this.elementTimelineRuler.moveTime(e),this.elementTimelineRuler.mousemoveEventHandler=this.elementTimelineRuler.handleMousemove.bind(this.elementTimelineRuler),document.addEventListener("mousemove",this.elementTimelineRuler.mousemoveEventHandler)}handleMouseup(e){document.removeEventListener("mousemove",this.elementTimelineRuler.mousemoveEventHandler)}connectedCallback(){this.render(),this.addEventListener("mousedown",this.handleMousedown.bind(this)),document.addEventListener("mouseup",this.handleMouseup.bind(this))}}class L extends HTMLElement{constructor(){super(),this.mousemoveEventHandler=void 0,this.mouseTimeout=void 0,this.rulerType="sec"}render(){this.innerHTML="";const e=this.template();this.classList.remove("ruler-sec","ruler-min"),this.classList.add("timeline-ruler","ruler"),this.innerHTML=e,this.addTickNumber(10)}template(){return'<ul class="ruler-x">\n        <li></li><li></li><li></li><li></li><li></li> \x3c!-- repeat --\x3e\n      </ul>'}addTickNumber(e){let t="<li></li>".repeat(e);this.querySelector("ul").innerHTML=t}updateRulerSpace(e){this.style.removeProperty("--ruler2-space"),this.style.removeProperty("--ruler1-space");let t=50*e,i=5*e,n=1;console.log(e,this.rulerType[0]),e>=.5?(this.render(),this.rulerType="sec",n=1):e<.5&&e>=.1?(this.render(),this.rulerType="sec6",t=300*e,i=30*e,n=6):(this.render(),this.rulerType="min",t=3e3*e,i=300*e,n=1),this.style.setProperty("--ruler1-space",i),this.style.setProperty("--ruler2-space",t),this.style.setProperty("--ruler3-space",n),this.style.setProperty("--ruler3-space-minus",-n),this.querySelector(".ruler-x").style.setProperty("--ruler-standard-unit",`'${this.rulerType[0]}'`)}updateRulerLength(e){let t=200*Number(e.value);this.changeWidth(t),this.addTickNumber(Number(e.value))}changeWidth(e){this.style.width=`${e}px`}setTopPosition(e){this.style.top=`${e}px`}moveTime(e){const t=document.querySelector("element-timeline-cursor"),i=document.querySelector("element-timeline"),n=document.querySelector("element-control");n.progress=e.pageX+i.scrollLeft,n.progressTime=n.getTimeFromProgress(),n.stop(),n.showTime(),n.appearAllElementInTime(),t.move(e.pageX+i.scrollLeft)}handleMousemove(e){const t=document.querySelector("element-timeline-cursor"),i=document.querySelector("element-timeline"),n=document.querySelector("element-control");t.move(e.pageX+i.scrollLeft),n.showTime(),clearTimeout(this.mouseTimeout),this.mouseTimeout=setTimeout((()=>{clearInterval(this.resizeInterval),this.moveTime(e)}),100)}handleMousedown(e){e.stopPropagation(),this.moveTime(e),this.mousemoveEventHandler=this.handleMousemove.bind(this),document.addEventListener("mousemove",this.mousemoveEventHandler)}handleMouseup(e){document.removeEventListener("mousemove",this.mousemoveEventHandler)}connectedCallback(){this.render(),this.addEventListener("mousedown",this.handleMousedown.bind(this)),document.addEventListener("mouseup",this.handleMouseup.bind(this))}}class I extends HTMLElement{constructor(){super(),this.value=.9}render(){const e=this.template();this.innerHTML=e}template(){return'<input ref="range" type="range" class="form-range" min="0" max="6" step="0.02" id="timelineRange" value="4">'}updateValue(){let e=this.querySelector("input[ref='range']");if((e.value*e.value/10).toFixed(3)<=0)return 0;this.value=(e.value*e.value/10).toFixed(3)}updateRange(){this.updateValue(),document.querySelector("element-control").changeTimelineRange()}connectedCallback(){this.render(),this.querySelector("input[ref='range']").addEventListener("input",this.updateRange.bind(this)),this.querySelector("input[ref='range']").addEventListener("change",this.updateRange.bind(this))}}class q extends HTMLElement{constructor(){super(),this.elementTimeline=document.querySelector("element-timeline"),this.elementControl=document.querySelector("element-control"),this.timeline=document.querySelector("element-timeline").timeline,this.elementId=this.getAttribute("element-id"),this.elementBarType=this.getAttribute("element-type")||"static",this.elementFileType=this.timeline[this.elementId].filetype,this.width=this.millisecondsToPx(this.timeline[this.elementId].duration),this.startTime=this.millisecondsToPx(this.timeline[this.elementId].startTime),this.isDrag=!1,this.isResize=!1,this.resizeLocation="left",this.initialDuration=1e3,this.initialPosition={x:0,y:0};let e=this.timeline[this.elementId].localpath.split("/");this.filepath=e[e.length-1],this.resizeEventHandler,this.dragEventHandler}render(){let e;e="static"==this.elementBarType?this.templateStatic():this.templateDynamic();const t=this.getRandomColor();this.classList.add("element-bar","d-block"),this.setAttribute("style",`width: ${this.width}px; left: ${this.startTime}px; background-color: ${t};`),this.setAttribute("value",this.elementId),this.innerHTML=e,this.setTrimBar()}setTrimBar(){if("dynamic"==this.elementBarType){let e=this.millisecondsToPx(this.timeline[this.elementId].trim.startTime),t=this.millisecondsToPx(this.timeline[this.elementId].trim.endTime);this.setTrimStart(e),this.setTrimEnd(t),this.elementControl.changeTimelineRange()}}templateStatic(){return`\n        ${this.filepath}\n        <div class="element-bar-resize-left position-absolute" onmousedown="this.parentNode.resizeMousedown(this, 'left')"></div>\n        <div class="element-bar-resize-right position-absolute" onmousedown="this.parentNode.resizeMousedown(this, 'right')"></div>\n        `}templateDynamic(){return`\n        ${this.filepath}\n        <div class="element-bar-hiddenspace-left position-absolute">\n            <div class="element-bar-resize-hiddenspace-left position-absolute" onmousedown="this.parentNode.parentNode.resizeRangeMousedown(this, 'left')">\n            </div>\n        </div>\n        <div class="element-bar-hiddenspace-right position-absolute">\n            <div class="element-bar-resize-hiddenspace-right position-absolute" onmousedown="this.parentNode.parentNode.resizeRangeMousedown(this, 'right')">\n            </div>\n        </div>\n        `}getRandomArbitrary(e,t){return Math.round(Math.random()*(t-e)+e)}getRandomColor(){return`rgb(${this.getRandomArbitrary(45,167)},${this.getRandomArbitrary(23,139)},${this.getRandomArbitrary(56,180)})`}animationPanelMove(e){if("dynamic"==this.elementBarType)return 0;document.querySelector(`animation-panel[element-id="${this.elementId}"]`).move(e)}drag(e){if(this.isDrag){let t=e.pageX-this.initialPosition.x;e.pageY,this.initialPosition.y,this.style.left=`${t}px`,this.animationPanelMove(t),this.timeline[this.elementId].startTime=this.pxToMilliseconds(t),this.dragEditGuide()}}dragEditGuide(){let e=Number(this.style.left.split("px")[0]);Number(this.style.left.split("px")[0]),Number(this.style.width.split("px")[0]);for(const t in this.timeline)if(Object.hasOwnProperty.call(this.timeline,t)){if(t==this.elementId)continue;const i=this.timeline[t];let n=this.millisecondsToPx(i.startTime),s=this.millisecondsToPx(i.startTime+i.duration),l=10;e>n-l&&e<n+l&&(this.style.left=`${n}px`,this.timeline[this.elementId].startTime=this.pxToMilliseconds(n)),e>s-l&&e<s+l&&(this.style.left=`${s}px`,this.timeline[this.elementId].startTime=this.pxToMilliseconds(s))}}dragMousedown(e){this.addEventListener("mousemove",this.drag),this.isDrag=!0,this.initialPosition.x=e.pageX-Number(this.style.left.split("px")[0]),this.initialPosition.y=e.pageY,this.dragEventHandler=this.drag.bind(this),document.addEventListener("mousemove",this.dragEventHandler)}dragMouseup(){document.removeEventListener("mousemove",this.dragEventHandler),this.isDrag=!1}setWidth(e){this.style.width=`${e}px`}setLeft(e){this.style.left=`${e}px`}setTrimStart(e){this.querySelector(".element-bar-hiddenspace-left").style.width=`${e}px`}setTrimEnd(e){if(this.millisecondsToPx(this.timeline[this.elementId].duration)-this.millisecondsToPx(this.timeline[this.elementId].trim.startTime)<e)return 0;this.querySelector(".element-bar-hiddenspace-right").style.width=`${e}px`}millisecondsToPx(e){return e/5*(Number(document.querySelector("element-timeline-range").value)/4)}pxToMilliseconds(e){return 5*e/(Number(document.querySelector("element-timeline-range").value)/4)}resize(e){this.unselectThisElement(),this.isDrag=!1;let t=e.pageX-this.initialPosition.x,i=(e.pageY,this.initialPosition.y,this.initialDuration),n=document.querySelector("element-timeline").scrollLeft;"left"==this.resizeLocation?(this.setLeft(t),this.setWidth(i-t),this.timeline[this.elementId].startTime=this.pxToMilliseconds(t),this.timeline[this.elementId].duration=this.pxToMilliseconds(Number(this.style.width.split("px")[0])),this.animationPanelMove(t)):(this.setWidth(n+e.pageX-Number(this.style.left.split("px")[0])),this.timeline[this.elementId].duration=this.pxToMilliseconds(Number(this.style.width.split("px")[0])))}resizeRange(e){this.isDrag=!1;let t=e.pageX-this.initialPosition.x,i=this.initialDuration,n=Number(this.style.width.split("px")[0]),s=this.querySelector(".element-bar-hiddenspace-left"),l=this.querySelector(".element-bar-hiddenspace-right"),o=document.querySelector("element-timeline"),r=window.innerWidth,a=o.scrollWidth,d=Number(this.style.width.split("px")[0]),h=Number(this.style.left.split("px")[0]),m=r-n-h<0?a-(h+d):0,c=o.scrollLeft,u=a-r-c,p=r-n-h>0?r-n-h-10:0;"left"==this.resizeLocation?(this.setTrimStart(this.initialPosition.x+t+c-h),this.timeline[this.elementId].trim.startTime=this.pxToMilliseconds(Number(s.style.width.split("px")[0]))):(this.setTrimEnd(u+r-t-this.initialPosition.x-p-m),this.timeline[this.elementId].trim.endTime=this.pxToMilliseconds(i-Number(l.style.width.split("px")[0])))}resizeMousedown(e,t){this.isResize=!0,this.resizeLocation=t,this.isDrag=!1,this.initialPosition.x="left"==t?e.pageX-Number(this.style.left.split("px")[0]):Number(this.style.left.split("px")[0]),this.initialPosition.y=e.pageY,this.initialDuration=this.millisecondsToPx(this.timeline[this.elementId].duration)+Number(this.style.left.split("px")[0]),this.resizeEventHandler=this.resize.bind(this),document.addEventListener("mousemove",this.resizeEventHandler)}resizeRangeMousedown(e,t){this.isResize=!0,this.resizeLocation=t,this.resizeRangeLeft=Number(this.querySelector(".element-bar-hiddenspace-left").style.width.split("px")[0]),this.resizeRangeRight=Number(this.querySelector(".element-bar-hiddenspace-right").style.width.split("px")[0]),this.isDrag=!1,this.initialPosition.x=Number(this.style.left.split("px")[0]),this.initialDuration=this.millisecondsToPx(this.timeline[this.elementId].duration+Number(this.style.left.split("px")[0])),this.resizeEventHandler=this.resizeRange.bind(this),document.addEventListener("mousemove",this.resizeEventHandler)}resizeMouseup(){document.removeEventListener("mousemove",this.resizeEventHandler),this.isResize=!1}changeOutlineColor(e="add"){"add"==e?this.classList.add("border-inner-light"):"remove"==e&&this.classList.remove("border-inner-light")}selectThisElement(){const e=document.querySelector("element-control");if(e.selectElementsId.includes(this.elementId))return 0;e.selectElementsId.push(this.elementId),this.changeOutlineColor("add")}unselectThisElement(){const e=document.querySelector("element-control");e.selectElementsId=e.selectElementsId.filter((e=>e!==this.elementId)),this.changeOutlineColor("remove")}animationPanelDropdownTemplate(){if("dynamic"==this.elementBarType||"text"==this.elementFileType)return"";let e=this.isShowAnimationPanel(),t=1==e?"애니메이션 패널 닫기":"애니메이션 패널 열기";return`<menu-dropdown-item onclick=${1==e?`document.querySelector("animation-panel[element-id='${this.elementId}']").hide()`:`document.querySelector("animation-panel[element-id='${this.elementId}']").show()`} item-name="${t}"></menu-dropdown-item>`}isShowAnimationPanel(){return document.querySelector(`animation-panel[element-id='${this.elementId}']`).isShow}showMenuDropdown({x:e,y:t}){let i=this.animationPanelDropdownTemplate();document.querySelector("#menuRightClick").innerHTML=`\n            <menu-dropdown-body top="${t}" left="${e}">\n            ${i}\n\n            <menu-dropdown-item onclick="document.querySelector('element-timeline').removeSeletedElements()" item-name="삭제"> </menu-dropdown-item>\n        </menu-dropdown-body>`}showSideOption(){document.querySelector("option-group").showOption({filetype:this.elementFileType,elementId:this.elementId})}rightclick(e){if(3!=e.which&&2!=e.button)return 0;this.showMenuDropdown({x:e.clientX,y:e.clientY})}handleMousedown(e){this.selectThisElement(),this.dragMousedown(e),this.showSideOption()}handleMouseup(e){this.rightclick(e),this.selectThisElement()}connectedCallback(){this.render(),this.addEventListener("mousedown",this.handleMousedown.bind(this)),this.addEventListener("mouseup",this.handleMouseup.bind(this)),document.addEventListener("mouseup",this.dragMouseup.bind(this)),document.addEventListener("mouseup",this.resizeMouseup.bind(this))}disconnectedCallback(){this.removeEventListener("mousedown",this.handleMousedown),this.removeEventListener("mouseup",this.handleMouseup),document.removeEventListener("mouseup",this.dragMouseup),document.removeEventListener("mouseup",this.resizeMouseup)}}class A extends HTMLElement{constructor(){super(),this.elementTimeline,this.timeline,this.timelineCursor,window.addEventListener("DOMContentLoaded",(()=>{this.elementTimeline=document.querySelector("element-timeline"),this.timeline=document.querySelector("element-timeline").timeline,this.timelineCursor=document.querySelector("element-timeline-cursor")})),this.scroller=void 0,this.resizeTimeout=void 0,this.resizeInterval=void 0,this.isResizeStart=!1,this.previousPreviewSize={w:1920,h:1080},this.isPaused=!0,this.isPlay={},this.activeElementId="",this.selectElementsId=[],this.existActiveElement=!1,this.progress=0,this.progressTime=0,this.previewRatio=1,this.resizeEvent()}async resizeEvent(){this.resizePreview(),clearTimeout(this.resizeTimeout),0==this.isResizeStart&&(this.isResizeStart=!0,this.resizeInterval=setInterval((()=>{this.matchAllElementsSizeToPreview()}),50)),this.resizeTimeout=setTimeout((()=>{clearInterval(this.resizeInterval),this.isResizeStart=!1}),300)}resizePreview(){let e=document.getElementById("split_col_2").offsetWidth,t=(document.getElementById("split_top").offsetHeight,document.getElementById("split_bottom").offsetHeight),i=document.getElementById("videobox").offsetHeight,n=document.getElementById("video").offsetHeight,s=(document.querySelector("element-timeline").offsetHeight,Math.round(.95*e)),l=Math.round(9*s/16),o=.92*(window.innerHeight-(t+20)-(i-n)),r=o*(16/9),a=s>r?r:s,d=l>o?o:l;preview.width=a,preview.height=d,preview.style.width=`${a}px`,preview.style.height=`${d}px`,video.style.width=`${a}px`,video.style.height=`${d}px`,this.previewRatio=1920/a}matchAllElementsSizeToPreview(e){for(const e in this.timeline)if(Object.hasOwnProperty.call(this.timeline,e)){let t=document.querySelector(`#element-${e}`),i=Number(this.timeline[e].height)/this.previewRatio,n=Number(this.timeline[e].width)/this.previewRatio,s=Number(this.timeline[e].location.y)/this.previewRatio,l=Number(this.timeline[e].location.x)/this.previewRatio;if("text"!=this.timeline[e].filetype)t.resizeStyle({x:l,y:s,w:n,h:i});else if("text"==this.timeline[e].filetype){let o=Number(this.timeline[e].fontsize)/this.previewRatio;t.resizeStyle({x:l,y:s,w:n,h:i}),t.resizeFont({px:o})}}}removeElementById(e){this.querySelector(`element-control-asset[element-id="${e}"]`).remove(),this.timeline=document.querySelector("element-timeline").timeline}removeAllElementAsset(){this.querySelectorAll("element-control-asset").forEach((e=>{e.remove()})),this.timeline=document.querySelector("element-timeline").timeline}fitElementSizeOnPreview(e,t){let i={w:Number(document.querySelector("#video").style.width.split("px")[0]),h:Number(document.querySelector("#video").style.height.split("px")[0])},n=t<i.h?t:i.h;return{width:n*(e/t),height:n}}addImage(e,t){const i=this.generateUUID(),n=document.createElement("img");n.src=e,n.onload=()=>{let s=this.fitElementSizeOnPreview(n.width,n.height),l=s.width,o=s.height;this.timeline[i]={blob:e,startTime:0,duration:1e3,location:{x:0,y:0},rotation:0,width:l,height:o,localpath:t,filetype:"image",animation:{position:{isActivate:!1,points:[[],[]],allpoints:[[],[]]},opacity:{isActivate:!1,points:[[]],allpoints:[[]]}}},this.showImage(i),this.elementTimeline.addElementBar(i)}}addVideo(e,t){const i=this.generateUUID(),n=document.createElement("video"),s=bootstrap.Toast.getInstance(document.getElementById("loadMetadataToast"));s.show(),n.src=e,n.preload="metadata",n.onloadedmetadata=()=>{let l=n.videoWidth,o=n.videoHeight,r=1e3*n.duration;window.electronAPI.req.ffmpeg.getMetadata(e,t),window.electronAPI.res.ffmpeg.getMetadata(((n,a,d)=>{if(a!=e)return 0;let h=!1;setTimeout((()=>{s.hide()}),1e3),d.streams.forEach((e=>{"audio"==e.codec_type&&(h=!0)})),this.timeline[i]={blob:e,startTime:0,duration:r,location:{x:0,y:0},trim:{startTime:0,endTime:r},rotation:0,width:l,height:o,localpath:t,isExistAudio:h,filetype:"video",codec:{video:"default",audio:"default"}},this.showVideo(i),this.elementTimeline.addElementBar(i)}))}}addText(){const e=this.generateUUID();this.timeline[e]={startTime:0,duration:1e3,text:"텍스트",textcolor:"#ffffff",fontsize:52,fontname:"notosanskr",fontweight:"medium",fonttype:"otf",location:{x:0,y:0},rotation:0,localpath:"/TEXTELEMENT",filetype:"text",height:52,width:500,widthInner:200,animation:{position:{isActivate:!1,points:[[],[]],allpoints:[[],[]]},opacity:{isActivate:!1,points:[[]],allpoints:[[]]}}},this.showText(e),this.elementTimeline.addElementBar(e)}addAudio(e,t){const i=this.generateUUID(),n=document.createElement("audio");n.src=e,n.onloadedmetadata=()=>{let s=1e3*n.duration;this.timeline[i]={blob:e,startTime:0,duration:s,location:{x:0,y:0},trim:{startTime:0,endTime:s},localpath:t,filetype:"audio"},this.showAudio(i),this.elementTimeline.addElementBar(i)}}showAnimation(e,t){let i=20*Math.round(document.querySelector("element-control").progressTime/20),n=Number(this.timeline[e].startTime),s=Math.round((i-n)/20);try{if(s<0)return 0;document.querySelector(`#element-${e}`).style.left=this.timeline[e].animation[t].allpoints[0][s].y/this.previewRatio+"px",document.querySelector(`#element-${e}`).style.top=this.timeline[e].animation[t].allpoints[1][s].y/this.previewRatio+"px"}catch(e){}}showImage(e){null==document.getElementById(`element-${e}`)?this.insertAdjacentHTML("beforeend",`<element-control-asset element-id="${e}" element-filetype="image"></element-control-asset>`):document.querySelector(`#element-${e}`).classList.remove("d-none");1==this.timeline[e].animation.position.isActivate&&this.showAnimation(e,"position")}showVideo(e){if(null==document.getElementById(`element-${e}`)){this.insertAdjacentHTML("beforeend",`<element-control-asset element-id="${e}" element-filetype="video"></element-control-asset>`);let t=document.getElementById(`element-${e}`).querySelector("video"),i=(this.timeline[e].startTime-this.progressTime)/1e3;t.currentTime=i}else{let t=document.getElementById(`element-${e}`).querySelector("video"),i=-(this.timeline[e].startTime-this.progressTime)/1e3;t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2?this.isPaused&&console.log("paused"):this.isPaused?(t.pause(),this.isPlay[e]=!1):(this.isPlay[e]||(t.currentTime=i,t.play()),this.isPlay[e]=!0),document.querySelector(`#element-${e}`).classList.remove("d-none")}}showAudio(e){if(null==document.getElementById(`element-${e}`)){this.insertAdjacentHTML("beforeend",`<element-control-asset element-id="${e}" element-filetype="audio"></element-control-asset>`);let t=document.getElementById(`element-${e}`).querySelector("audio"),i=(this.timeline[e].startTime-this.progressTime)/1e3;t.currentTime=i}else{let t=document.getElementById(`element-${e}`).querySelector("audio"),i=-(this.timeline[e].startTime-this.progressTime)/1e3;t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2?(this.isPaused&&console.log("paused"),console.log("isPlaying")):(t.currentTime=i,this.isPaused?t.pause():t.play()),document.querySelector(`#element-${e}`).classList.remove("d-none")}}showText(e){null==document.getElementById(`element-${e}`)?this.insertAdjacentHTML("beforeend",`<element-control-asset element-id="${e}" element-filetype="text"></element-control-asset>`):document.querySelector(`#element-${e}`).classList.remove("d-none"),1==this.timeline[e].animation.isActivate&&this.timeline[e].animation.allpoints.length>document.querySelector("element-control").progress&&this.showAnimation(e)}changeText(e){let t=document.querySelector(`#element-${e}`),i=t.querySelector("input-text"),n=(i.querySelector("span"),i.value);this.timeline[e].text=n,t.style.width=`${i.offsetWidth}px`}changeTextColor({elementId:e,color:t}){document.querySelector(`#element-${e}`).querySelector("input-text").style.color=t,this.timeline[e].textcolor=t}changeTextSize({elementId:e,size:t}){let i=document.querySelector(`#element-${e}`),n=i.querySelector("input-text");n.setWidthInner();let s=Number(t)/this.previewRatio;i.style.fontSize=`${s}px`,i.style.height=`${s}px`,n.style.top=s/2+"px",this.timeline[e].fontsize=Number(t),this.timeline[e].height=Number(t)}changeTextFont({elementId:e,fontPath:t,fontType:i,fontName:n}){let s=document.querySelector(`#element-${e}`);s.querySelector("input-text"),s.style.fontFamily=n}changeTimelineRange(){const e=document.querySelector("element-timeline-ruler"),t=Number(document.querySelector("element-timeline-range").value),i=t/4;if(0==t)return 0;e.updateRulerSpace(i),this.timelineCursor.move(this.progressTime/5*i),this.adjustAllElementBarWidth(i),this.updateAllAnimationPanel()}updateAllAnimationPanel(){for(const e in this.timeline)if(Object.hasOwnProperty.call(this.timeline,e)){const t=this.timeline[e];if("image"!=t.filetype)continue;if(0==t.animation.position.isActivate)continue;let i=document.querySelector(`animation-panel[element-id="${e}"]`),n=document.querySelector(`element-bar[element-id="${e}"]`),s=n.millisecondsToPx(this.timeline[e].startTime);i.updateItem(),n.animationPanelMove(s)}}getTimeFromProgress(){let e=Number(document.querySelector("element-timeline-range").value)/4;return 5*this.progress/e}getTimeFromTimelineBar(){return 5*Number(this.timelineCursor.style.left.split("px")[0])/(Number(document.querySelector("element-timeline-range").value)/4)}adjustAllElementBarWidth(e){document.querySelectorAll("element-bar").forEach((e=>{let t=e.getAttribute("element-id"),i=e.millisecondsToPx(this.timeline[t].duration),n=e.millisecondsToPx(this.timeline[t].startTime);if(e.setWidth(i),e.setLeft(n),"dynamic"==e.elementBarType){let i=e.millisecondsToPx(this.timeline[t].trim.startTime),n=e.millisecondsToPx(this.timeline[t].duration-this.timeline[t].trim.endTime);e.setTrimStart(i),e.setTrimEnd(n)}}))}getMillisecondsToISOTime(e){return new Date(e).toISOString().slice(11,22)}progressToTime(){let e=5*this.progress;return new Date(e).toISOString().slice(11,22)}generateUUID(){return x()}showTime(){const e=document.querySelector("#time"),t=this.getTimeFromTimelineBar(),i=this.getMillisecondsToISOTime(t);e.innerHTML=i}hideElement(e){"video"==this.timeline[e].filetype?this.pauseVideo(e):"audio"==this.timeline[e].filetype&&this.pauseAudio(e),document.querySelector(`#element-${e}`).classList.add("d-none")}appearAllElementInTime(){for(let e in this.timeline){let t=this.timeline[e].filetype,i=this.timeline[e].startTime>this.progressTime||this.timeline[e].startTime+this.timeline[e].duration<this.progressTime;"video"!=t&&"audio"!=t||(i=this.timeline[e].startTime+this.timeline[e].trim.startTime>this.progressTime||this.timeline[e].startTime+this.timeline[e].trim.endTime<this.progressTime),i?this.hideElement(e):"image"==t?this.showImage(e):"video"==t?this.showVideo(e):"text"==t?this.showText(e):"audio"==t&&this.showAudio(e)}}play(){let e=document.querySelector("#playToggle");e.setAttribute("onclick","elementControlComponent.stop()"),e.innerHTML='<span class="material-symbols-outlined icon-white icon-md"> stop_circle </span>',this.scroller=setInterval((()=>{let e=Number(document.querySelector("element-timeline-range").value),t=Number(this.timelineCursor.style.left.split("px")[0])+e;this.progress=t,this.progressTime=this.getTimeFromProgress(),this.timelineCursor.move(t),this.showTime(),this.innerWidth+this.offsetWidth>=this.offsetWidth&&this.stop(),this.appearAllElementInTime()}),20),this.isPaused=!1}stop(){clearInterval(this.scroller);const e=document.querySelector("#playToggle");this.isPaused=!0;for(const e in this.timeline)Object.hasOwnProperty.call(this.timeline,e)&&(this.isPlay[e]=!1);e.setAttribute("onclick","elementControlComponent.play()"),e.innerHTML='<span class="material-symbols-outlined icon-white icon-md"> play_circle </span>',this.showTime(),this.pauseAllDynamicElements()}pauseVideo(e){let t=-(this.timeline[e].startTime-this.progressTime)/1e3,i=document.getElementById(`element-${e}`).querySelector("video");i.currentTime=t,i.pause()}pauseAudio(e){document.getElementById(`element-${e}`).querySelector("audio").pause()}pauseAllDynamicElements(){let e;for(e in this.timeline){let t=this.timeline[e].filetype;"video"==t?this.pauseVideo(e):"audio"==t&&this.pauseAudio(e)}}deactivateAllOutline(){for(const e in this.timeline)Object.hasOwnProperty.call(this.timeline,e)&&document.querySelector(`#element-${e}`).classList.remove("element-outline");this.activeElementId="",this.existActiveElement=!1}reset(){this.progress=0,this.progressTime=0,this.isPaused=!0,this.showTime(),this.appearAllElementInTime(),this.timelineCursor.move(0)}handleClickPreview(){this.deactivateAllOutline()}connectedCallback(){preview.addEventListener("click",this.handleClickPreview.bind(this))}}class P extends HTMLElement{constructor(){super(),this.timeline=document.querySelector("element-timeline").timeline,this.elementControl=document.querySelector("element-control"),this.elementId=this.getAttribute("element-id"),this.elementFiletype=this.getAttribute("element-filetype")||"image",this.isDrag=!1,this.isResize=!1,this.isRotate=!1,this.initialPosition={x:0,y:0,w:0,h:0},this.resizeDirection="n",this.resizeEventHandler,this.rotateEventHandler,this.dragdownEventHandler,this.dragupEventHandler}render(){let e;"image"==this.elementFiletype?e=this.templateImage()+this.templateResize():"video"==this.elementFiletype?e=this.templateVideo()+this.templateResize():"text"==this.elementFiletype?e=this.templateText()+this.templateResize("horizon"):"audio"==this.elementFiletype&&(e=this.templateAudio()),this.innerHTML=e;let t=this.convertAbsoluteToRelativeSize({x:this.timeline[this.elementId].location.x,y:this.timeline[this.elementId].location.y,w:this.timeline[this.elementId].width?this.timeline[this.elementId].width:500,h:this.timeline[this.elementId].height});if(this.classList.add("element-drag"),this.setAttribute("id",`element-${this.elementId}`),"text"!==this.elementFiletype)this.setAttribute("style",`width: ${t.w}px; top: ${t.y}px; left: ${t.x}px; height: ${t.h}px; transform: rotate(${this.timeline[this.elementId].rotation}deg);`);else if("text"==this.elementFiletype){let e=this.elementControl.previewRatio,i=this.timeline[this.elementId].fontsize/e;this.setAttribute("style",`width: ${t.w}px; top: ${t.y}px; left: ${t.x}px; height: ${i}px; font-size: ${i}px;`),this.querySelector("input-text").style.top=i/2+"px"}}convertAbsoluteToRelativeSize({x:e,y:t,w:i,h:n}){let s=this.elementControl.previewRatio;return{x:e/s,y:t/s,w:i/s,h:n/s}}convertRelativeToAbsoluteSize({x:e,y:t,w:i,h:n}){let s=this.elementControl.previewRatio;return{x:e*s,y:t*s,w:i*s,h:n*s}}templateImage(){return`\n        <img src="${this.timeline[this.elementId].blob}" alt="" class="element-image" draggable="false">`}templateVideo(){return`\n        <video src="${this.timeline[this.elementId].blob}" alt="" class="element-video" draggable="false"></video>`}templateAudio(){return`\n        <audio src="${this.timeline[this.elementId].blob}" class="d-none" draggable="false"></video>`}templateText(){return this.elementControl.previewRatio,`<input-text element-id="${this.elementId}"></input-text>`}templateResize(e="full"){let t='<div class="resize-n" onmousedown="this.parentNode.resizeMousedown(\'n\')"></div>',i='<div class="resize-s" onmousedown="this.parentNode.resizeMousedown(\'s\')"></div>',n='<div class="resize-w" onmousedown="this.parentNode.resizeMousedown(\'w\')"></div>',s='<div class="resize-e" onmousedown="this.parentNode.resizeMousedown(\'e\')"></div>';return"full"==e?`\n            ${t}\n            ${i}\n            ${n}\n            ${s}\n            <div class="resize-ne" onmousedown="this.parentNode.resizeMousedown('ne')"></div>\n            <div class="resize-nw" onmousedown="this.parentNode.resizeMousedown('nw')"></div>\n            <div class="resize-se" onmousedown="this.parentNode.resizeMousedown('se')"></div>\n            <div class="resize-sw" onmousedown="this.parentNode.resizeMousedown('sw')"></div>\n            `:"vertical"==e?`\n            ${t}\n            ${i}\n            `:"horizon"==e?`\n            ${n}\n            ${s}\n            `:void 0}templateRotate(){return'<div class="handle-rotate text-center" onmousedown="this.parentNode.rotateMousedown()">\n        <span class="material-symbols-outlined handle-rotate-icon">\ncached\n</span>\n        </div>'}pxToInteger(e="0px"){return Number(e.split("px")[0])}showDragAlignmentGuide(){let e=document.querySelector("drag-alignment-guide"),t=document.querySelector("#video"),i=Number(t.style.width.split("px")[0]),n=Number(t.style.height.split("px")[0]),s=Number(this.style.top.split("px")[0]),l=Number(this.style.left.split("px")[0]),o=Number(this.style.width.split("px")[0]),r=Number(this.style.height.split("px")[0]),a=Number(this.style.height.split("px")[0])/2+Number(this.style.top.split("px")[0]),d=Number(this.style.width.split("px")[0])/2+Number(this.style.left.split("px")[0]);if(s<6&&s>-6){e.showGuide({position:"top"});let t=0;this.style.top=`${t}px`;let i=this.convertRelativeToAbsoluteSize({y:t});this.timeline[this.elementId].location.y=i.y}else e.hideGuide({position:"top"});if(s+r>n-6&&s+r<n+6){e.showGuide({position:"bottom"});let t=n-r;this.style.top=`${t}px`;let i=this.convertRelativeToAbsoluteSize({y:t});this.timeline[this.elementId].location.y=i.y}else e.hideGuide({position:"bottom"});if(l<6&&l>-6){e.showGuide({position:"left"});let t=0;this.style.left=`${t}px`;let i=this.convertRelativeToAbsoluteSize({x:t});this.timeline[this.elementId].location.x=i.x}else e.hideGuide({position:"left"});if(l+o>i-6&&l+o<i+6){e.showGuide({position:"right"});let t=i-o;this.style.left=`${t}px`;let n=this.convertRelativeToAbsoluteSize({x:t});this.timeline[this.elementId].location.x=n.x}else e.hideGuide({position:"right"});if(a<n/2+6&&a>n/2-6){e.showGuide({position:"horizontal"});let t=n/2-r/2;this.style.top=`${t}px`;let i=this.convertRelativeToAbsoluteSize({y:t});this.timeline[this.elementId].location.y=i.y}else e.hideGuide({position:"horizontal"});if(d<i/2+6&&d>i/2-6){e.showGuide({position:"vertical"});let t=i/2-o/2;this.style.left=`${t}px`;let n=this.convertRelativeToAbsoluteSize({x:t});this.timeline[this.elementId].location.x=n.x}else e.hideGuide({position:"vertical"})}hideDragAlignmentGuide(){let e=document.querySelector("drag-alignment-guide");e.hideGuide({position:"top"}),e.hideGuide({position:"bottom"}),e.hideGuide({position:"left"}),e.hideGuide({position:"right"}),e.hideGuide({position:"horizontal"}),e.hideGuide({position:"vertical"})}drag(e){if(this.isDrag){let t=e.clientX-this.initialPosition.x,i=e.clientY-this.initialPosition.y,n=["img","video","input"],s="";for(let e=0;e<n.length;e++)this.querySelector(n[e])&&(s=n[e]);t>window.innerWidth?document.removeEventListener("mousemove",this.dragdownEventHandler):(this.changeLocation({x:t,y:i}),"image"==this.elementFiletype&&document.querySelector("option-image").updateValue()),this.showDragAlignmentGuide()}}changeLocation({x:e,y:t}){this.style.top=`${t}px`,this.style.left=`${e}px`;let i=this.convertRelativeToAbsoluteSize({x:e,y:t});this.timeline[this.elementId].location.x=i.x,this.timeline[this.elementId].location.y=i.y}dragMousedown(e){this.isResize||this.isRotate||(this.isDrag=!0,this.initialPosition.x=e.pageX-this.pxToInteger(this.style.left),this.initialPosition.y=e.pageY-this.pxToInteger(this.style.top),this.dragdownEventHandler=this.drag.bind(this),document.addEventListener("mousemove",this.dragdownEventHandler))}dragMouseup(){this.hideDragAlignmentGuide(),document.removeEventListener("mousemove",this.dragdownEventHandler),1==this.isDrag&&"image"==this.timeline[this.elementId].filetype&&this.addAnimationPoint({animationType:"position"}),this.isDrag=!1}addAnimationPoint({animationType:e}){if(0==this.timeline[this.elementId].animation[e].isActivate)return 0;Number(document.querySelector("element-timeline-range").value);let t=document.querySelector(`keyframe-editor[element-id="${this.elementId}"]`),i=(this.elementControl.progressTime-this.timeline[this.elementId].startTime)/5;({position:()=>{t.addPoint({x:i,y:this.timeline[this.elementId].location.x,line:0}),t.addPoint({x:i,y:this.timeline[this.elementId].location.y,line:1}),t.drawLine(0),t.drawLine(1)}})[e](),document.querySelector(`animation-panel[element-id="${this.elementId}"]`).updateItem()}getGcd(e,t){return 0==t?e:this.getGcd(t,e%t)}rotate(e){if(this.isDrag=!1,console.log("rotate",e.target.tagName),"CANVAS"!=e.target.tagName)return 0;let t=this.convertAbsoluteToRelativeSize({x:this.timeline[this.elementId].location.x+this.timeline[this.elementId].width/2,y:this.timeline[this.elementId].location.y+this.timeline[this.elementId].height/2}),i=e.offsetX,n=e.offsetY,s=-Math.atan2(t.x-i,t.y-n)/(Math.PI/180);console.log(),s<0&&(s=360+s),this.timeline[this.elementId].rotation=s,this.style.transform=`rotate(${s}deg)`}resize(e){this.isDrag=!1;const t=document.querySelector("#video").getBoundingClientRect();let i=e.pageX-t.left-this.initialPosition.x,n=e.pageY-t.top-this.initialPosition.y;switch(this.initialPosition.w,this.initialPosition.h,this.resizeDirection){case"n":this.resizeStyle({y:this.initialPosition.y+n,h:this.initialPosition.h-n});break;case"s":this.resizeStyle({y:this.initialPosition.y,h:n});break;case"w":this.resizeStyle({x:this.initialPosition.x+i,w:this.initialPosition.w-i});break;case"e":this.resizeStyle({x:this.initialPosition.x,w:i});break;case"ne":this.resizeStyle({y:this.initialPosition.y+n,h:this.initialPosition.h-n,w:i});break;case"nw":this.resizeStyle({x:this.initialPosition.x+i,y:this.initialPosition.y+n,h:this.initialPosition.h-n,w:this.initialPosition.w-i});break;case"sw":this.resizeStyle({x:this.initialPosition.x+i,h:n,w:this.initialPosition.w-i});break;case"se":this.resizeStyle({x:this.initialPosition.x,y:this.initialPosition.y,h:n,w:i})}let s=this.elementControl.previewRatio;this.timeline[this.elementId].location.y=Math.round(Number(this.style.top.split("px")[0])*s),this.timeline[this.elementId].location.x=Math.round(Number(this.style.left.split("px")[0])*s),this.timeline[this.elementId].width=Math.round(Number(this.style.width.split("px")[0])*s),this.timeline[this.elementId].height=Math.round(Number(this.style.height.split("px")[0])*s)}resizeStyle({x:e,y:t,w:i,h:n}){this.style.left=0==!e?`${e}px`:this.style.left,this.style.top=0==!t?`${t}px`:this.style.top,this.style.width=0==!i?`${i}px`:this.style.width,this.style.height=0==!n?`${n}px`:this.style.height}resizeFont({px:e}){if(!this.querySelector("input-text"))return 0;this.querySelector("input-text"),this.style.fontSize=`${e}px`,this.elementControl.changeTextSize({elementId:this.elementId,size:this.timeline[this.elementId].fontsize})}rotateMousedown(){this.isDrag=!1,this.isResize=!1,0==this.isRotate&&(this.rotateEventHandler=this.rotate.bind(this),document.querySelector("#preview").addEventListener("mousemove",this.rotateEventHandler)),this.isRotate=!0}rotateMouseup(){document.querySelector("#preview").removeEventListener("mousemove",this.rotateEventHandler),this.isRotate=!1}resizeMousedown(e){this.isDrag=!1,this.isResize=!0,this.resizeDirection=e,this.initialPosition.w=Number(this.style.width.split("px")[0]),this.initialPosition.h=Number(this.style.height.split("px")[0]),this.initialPosition.x=Number(this.style.left.split("px")[0]),this.initialPosition.y=Number(this.style.top.split("px")[0]),this.resizeEventHandler=this.resize.bind(this),document.addEventListener("mousemove",this.resizeEventHandler)}resizeMouseup(){document.removeEventListener("mousemove",this.resizeEventHandler),this.isResize=!1}activateOutline(){this.elementControl.deactivateAllOutline(),this.elementControl.activeElementId=this.elementId,this.elementControl.existActiveElement=!0,this.classList.add("element-outline")}showSideOption(){document.querySelector("option-group").showOption({filetype:this.elementFiletype,elementId:this.elementId})}handleMousedown(e){this.dragMousedown(e),this.activateOutline(e),this.showSideOption()}handleDoubleClick(e){}connectedCallback(){this.render(),this.addEventListener("mousedown",this.handleMousedown.bind(this)),this.addEventListener("dblclick",this.handleDoubleClick.bind(this)),document.addEventListener("mouseup",this.resizeMouseup.bind(this)),document.addEventListener("mouseup",this.rotateMouseup.bind(this)),document.addEventListener("mouseup",this.dragMouseup.bind(this))}}class M extends HTMLElement{constructor(){super(),this.videoCanvas=document.querySelector("#video"),this.allPositions=["top","bottom","left","right","horizontal","vertical"]}addGuide(){for(let e=0;e<this.allPositions.length;e++){const t=this.allPositions[e];this.videoCanvas.insertAdjacentHTML("beforeend",`<alignment-guide position="${t}" class="alignment-guide alignment-guide-${t}"></alignment-guide>`),this.hideGuide({position:t})}}hideGuide({position:e}){this.videoCanvas.querySelector(`alignment-guide[position='${e}']`).classList.add("d-none")}showGuide({position:e}){this.videoCanvas.querySelector(`alignment-guide[position='${e}']`).classList.remove("d-none")}connectedCallback(){this.addGuide()}}class $ extends HTMLElement{constructor(){super(),this.timeline=document.querySelector("element-timeline").timeline,this.elementId=this.getAttribute("element-id"),this.animationType=this.getAttribute("animation-type"),this.tension=1,this.divBody=void 0,this.svgBody={},this.poly={},this.path={},this.hiddenPath={},this.padding={start:0,end:0},this.lineCount=1,this.points=[[[0,0]],[[0,0]]],this.selectLine=0}render(){this.showKeyframeEditorButtonGroup();const e=this.template();this.innerHTML=e,this.divBody=this.querySelector("div"),this.svgBody=this.divBody.querySelector("svg"),this.keyframePointBody=this.divBody.querySelector("keyframe-point"),this.lineCount=this.timeline[this.elementId].animation[this.animationType].points.length,0==this.timeline[this.elementId].animation[this.animationType].isActivate?(this.points[0][0][1]=this.timeline[this.elementId].location.x,this.points[1][0][1]=this.timeline[this.elementId].location.y):(this.points[0][0][1]=this.timeline[this.elementId].animation[this.animationType].points[0][0][1],this.points[1][0][1]=this.timeline[this.elementId].animation[this.animationType].points[1][0][1]),this.timeline[this.elementId].animation[this.animationType].isActivate=!0,this.clearLineEditorGroup();for(let e=0;e<this.lineCount;e++)this.addLineEditor(e),this.drawLine(e,!0),this.loadPoint(e);const t=Number(document.querySelector("element-timeline-range").value)/4;this.addPadding({px:this.timeline[this.elementId].startTime/5*t,type:"start"}),this.querySelector("div").classList.add("position-relative"),this.classList.add("h-100","w-100","position-absolute","overflow-scroll"),document.querySelector(`animation-panel[element-id="${this.elementId}"]`).updateItem(),this.fillBackground()}template(){return'\n        <div>\n        <keyframe-padding class="keyframe-padding" style="width: 100px;"></keyframe-padding>\n        <svg class="keyframe-svg" style="left: 100px;">\n\n        </svg>\n        <keyframe-point style="left: 100px;" class="position-absolute"></keyframe-point>\n\n        </div>'}showKeyframeEditorButtonGroup(){document.querySelector("#keyframeEditorButtonGroup").classList.remove("d-none")}hideKeyframeEditorButtonGroup(){document.querySelector("#keyframeEditorButtonGroup").classList.add("d-none");let e=document.getElementById("option_bottom");e.classList.remove("show"),e.classList.add("hide")}fillBackground(){setTimeout((()=>{this.querySelector("div").style.height=`${this.scrollHeight}px`,console.log("scrollHeight",this.scrollHeight)}),100)}addPadding({px:e,type:t}){let i=this.divBody.querySelector("keyframe-padding"),n=this.keyframePointBody,s=this.svgBody;const l={start:()=>{i.style.width=`${e}px`,n.style.left=`${e}px`,s.style.left=`${e}px`}};this.padding.start=e,l[t]()}highlightLineEditorButton(e){for(let e=0;e<this.lineCount;e++){let t=document.querySelector("#timelineOptionLineEditor").querySelector(`button[line='${e}']`);t.classList.remove("btn-primary"),t.classList.add("btn-secondary")}let t=document.querySelector("#timelineOptionLineEditor").querySelector(`button[line='${e}']`);t.classList.remove("btn-secondary"),t.classList.add("btn-primary")}changeLineEditor(e){this.selectLine=Number(e),this.highlightLineEditorButton(e)}addLineEditor(e){document.querySelector("#timelineOptionLineEditor").insertAdjacentHTML("beforeend",`<button line="${e}" onclick="document.querySelector('keyframe-editor').changeLineEditor('${e}')" type="button" class="btn btn-secondary btn-sm">Line${e}</button>`)}clearLineEditorGroup(){document.querySelector("#timelineOptionLineEditor").innerHTML=""}loadPoint(e){if(1==this.timeline[this.elementId].animation[this.animationType].isActivate){let t=this.timeline[this.elementId].animation[this.animationType].points[e];for(let i=0;i<t.length;i++){const n=t[i];0!=n[0]&&this.addPoint({x:n[0],y:n[1],line:e})}this.drawLine(e,!0),this.fillBackground()}}addPoint({x:e,y:t,line:i}){this.insertPointInMiddle({x:Math.round(e),y:Math.round(t),line:i}),this.drawPoint({x:e,y:t,line:i}),this.points[i][this.points[i].length-1][0],this.timeline[this.elementId].animation[this.animationType].isActivate=!0,this.timeline[this.elementId].animation[this.animationType].points[i]=this.points[i]}drawPoint({x:e,y:t,line:i}){let n=t-4,s=(e-4)*(Number(document.querySelector("element-timeline-range").value)/4);this.keyframePointBody.insertAdjacentHTML("beforeend",`<div class="position-absolute keyframe-point" style="top: ${n}px; left: ${s}px;"></div>`)}insertPointInMiddle({x:e,y:t,line:i}){if(this.points[i].length-1==0)return this.points[i].push([e,t]),0;for(let n=0;n<this.points[i].length;n++){if(this.points[i].length-1==n)return this.points[i].splice(n+1,0,[e,t]),0;if(this.points[i][n][0]<e&&this.points[i][n+1][0]>e)return this.points[i].splice(n+1,0,[e,t]),0}}getRemovedDuplicatePoint({x:e,line:t}){let i=[];return this.points[t].forEach((t=>{t[0]!=e&&i.push(t)})),i}drawLine(e,t=!0){this.querySelector("svg").insertAdjacentHTML("beforeend",`\n        <polyline id="keyframePolyline${e}" />\n        <path id="keyframePath${e}" class="keyframe-path-${e+1}" />\n        <path id="keyframeHiddenPath${e}" class="d-none" />`);const i=Number(document.querySelector("element-timeline-range").value)/4;let n=[];for(let t=0;t<this.points[e].length;t++)n.push([this.points[e][t][0]*i,this.points[e][t][1]]);this.path[e]=this.svgBody.querySelector(`path[id='keyframePath${e}']`),this.path[e].setAttribute("d",this.drawPath(n,this.tension)),this.hiddenPath[e]=this.svgBody.querySelector(`path[id='keyframeHiddenPath${e}']`),this.hiddenPath[e].setAttribute("d",this.drawPath(this.points[e],this.tension));let s=this.points[e][this.points[e].length-1][0]-1,l=this.getInterpolatedPoints(s,e,n);this.timeline[this.elementId].animation[this.animationType].allpoints[e]=l}drawPath(e,t){null==t&&(t=1);let i=2*e.length,n=i-4,s="M"+[e[0][0],e[0][1]],l=0;for(let o=0;o<i-2;o+=2){let i=l?e[l-1][0]:e[0][0],r=l?e[l-1][1]:e[0][1],a=e[l][0],d=e[l][1],h=e[l+1][0],m=e[l+1][1],c=o!==n?e[l+2][0]:h,u=o!==n?e[l+2][1]:m;l+=1,s+="C"+[a+(h-i)/6*t,d+(m-r)/6*t,h-(c-a)/6*t,m-(u-d)/6*t,h,m]}return s}getPointAt(e,t){let i=0,n=this.hiddenPath[t].getTotalLength(),s=(i+n)/2,l=this.hiddenPath[t].getPointAtLength(s);for(;Math.abs(l.x-e)>.5;)l.x<e?i=s:n=s,s=(i+n)/2,l=this.hiddenPath[t].getPointAtLength(s);return{x:l.x,y:l.y}}getInterpolatedPoints(e,t){let i=[],n=0;for(let s=0;s<Math.round(e/4);s++)i.push(this.getPointAt(n,t)),n+=4;return i}handleMousedown(e){const t=Number(document.querySelector("element-timeline-range").value)/4;let i=e.offsetX/t,n=e.offsetY;this.addPoint({x:i,y:n,line:this.selectLine}),this.drawLine(this.selectLine,!0),document.querySelector(`animation-panel[element-id="${this.elementId}"]`).updateItem()}handleScroll(e){if(0==document.querySelector("#option_bottom").classList.contains("show"))return 0;let t=document.querySelector("element-timeline");t.scrollTo(this.scrollLeft,t.scrollTop)}connectedCallback(){this.render(),this.svgBody.addEventListener("mousedown",this.handleMousedown.bind(this)),this.addEventListener("scroll",this.handleScroll.bind(this))}}class C extends HTMLElement{constructor(){super(),this.x=this.getAttribute("top"),this.y=this.getAttribute("left")}render(){const e=this.innerHTML,t=this.template();this.innerHTML=t,this.style.display="inline-block",this.querySelector("ul").innerHTML=e}template(){return`\n        <ul class="dropdown-menu show position-absolute " style="top: ${this.x}px; left: ${this.y}px; z-index: 6000;">\n\n        </ul>`}mousedown(){setTimeout((()=>{this.remove()}),200)}connectedCallback(){this.render(),document.addEventListener("click",this.mousedown.bind(this))}disconnectedCallback(){document.removeEventListener("click",this.mousedown.bind(this))}}class k extends HTMLElement{constructor(){super(),this.name=this.getAttribute("item-name")||"untitle"}render(){const e=this.template();this.innerHTML=e}template(){return`<li><a class="dropdown-item">${this.name}</a></li>`}connectedCallback(){this.render()}}class z extends HTMLElement{constructor(){super(),this.elementId=this.getAttribute("element-id"),this.isShow=!1}render(){const e=this.innerHTML,t=this.template();this.innerHTML=t,this.hide(),this.style.display="inline-block",this.classList.add("position-relative","w-100","bg-dark"),this.querySelector("div").innerHTML=e}updateItem(){const e=this.querySelector("div").innerHTML;this.clearItem();const t=this.template();this.innerHTML=t,this.querySelector("div").innerHTML=e}move(e){this.style.left=`${e}px`}clearItem(){this.innerHTML=""}show(){this.classList.remove("d-none"),this.isShow=!0,this.updateItem()}hide(){this.classList.add("d-none"),this.isShow=!1}template(){return'<div class="bg-dark">  </div>'}connectedCallback(){this.render()}disconnectedCallback(){}}class H extends HTMLElement{constructor(){super(),this.animationType=this.getAttribute("animation-type"),this.elementId=this.getAttribute("element-id"),this.timeline=document.querySelector("element-timeline").timeline}render(){if(0==this.checkAnimationType())return 0;this.style.width="100%",this.style.height="1.5rem",this.style.display="inline-block",this.classList.add("position-relative","d-flex","align-items-center"),this.clearPoints(),this.insertPointFromTimeline()}insertPointFromTimeline(){const e=Number(document.querySelector("element-timeline-range").value)/4;let t=this.timeline[this.elementId].animation[this.animationType].points[0];for(let i=0;i<t.length;i++){let n=t[i][0]*e;this.addPoint(n)}}clearPoints(){this.innerHTML=""}addPoint(e){this.insertAdjacentHTML("beforeend",`<div class="text-light position-absolute keyframe-diamond" style="left: ${e}px;">panel item </div>`)}checkAnimationType(){return["position","opacity"].includes(this.animationType)}showMenuDropdown({x:e,y:t}){document.querySelector("#menuRightClick").innerHTML=`<menu-dropdown-body top="${t}" left="${e}">\n            <menu-dropdown-item onclick="document.querySelector('element-timeline').showKeyframeEditor('${this.elementId}', '${this.animationType}')" item-name="키프레임 편집"></menu-dropdown-item>\n        </menu-dropdown-body>`}handleMouseup(e){this.rightclick(e)}rightclick(e){if(3!=e.which&&2!=e.button)return 0;this.showMenuDropdown({x:e.clientX,y:e.clientY})}connectedCallback(){this.render(),this.addEventListener("mouseup",this.handleMouseup.bind(this))}disconnectedCallback(){this.removeEventListener("mouseup",this.handleMouseup)}}class R extends HTMLElement{constructor(){super()}render(){}showOption({filetype:e,elementId:t}){this.hideAllOptions(),this.querySelector(`option-${e}`).show(),this.querySelector(`option-${e}`).setElementId({elementId:t})}hideAllOptions(){for(const e in this.children)if(Object.hasOwnProperty.call(this.children,e)){const t=this.children[e];console.log(t,this.children),t.hide()}}connectedCallback(){this.render()}}class D extends HTMLElement{constructor(){super(),this.elementId=""}render(){let e=this.template();this.innerHTML=e,this.hide()}template(){return'<div class="mb-2">\n        <label class="form-label text-light">텍스트 색상 선택</label>\n        <input aria-event="font-color" type="color" class="form-control bg-default form-control-color" value="#ffffff" title="Choose your color">\n    </div>\n\n    <div class="mb-2">\n        <label class="form-label text-light">폰트 크기</label>\n        <input aria-event="font-size" type="number" class="form-control bg-default text-light" value="52" >\n    </div>\n\n    <div class="mb-2">\n        <label class="form-label text-light">폰트</label>\n        <select-font></select-font>\n    </div>\n\n    \n    \n    '}hide(){this.classList.add("d-none")}show(){this.classList.remove("d-none")}setElementId({elementId:e}){this.elementId=e,this.resetValue()}resetValue(){const e=document.querySelector("element-timeline").timeline;this.querySelector("input[aria-event='font-color'").value=e[this.elementId].textcolor,this.querySelector("input[aria-event='font-size'").value=e[this.elementId].fontsize}handleChangeTextColor(){const e=document.querySelector("element-control"),t=this.querySelector("input[aria-event='font-color'").value;e.changeTextColor({elementId:this.elementId,color:t})}handleChangeTextSize(){const e=document.querySelector("element-control"),t=this.querySelector("input[aria-event='font-size'").value;e.changeTextSize({elementId:this.elementId,size:t})}handleChangeTextFont(){const e=this.querySelector("select-font");document.querySelector("element-control").changeTextFont({elementId:this.elementId,fontPath:e.path,fontType:e.type,fontName:e.fontname})}connectedCallback(){this.render(),this.querySelector("input[aria-event='font-color'").addEventListener("input",this.handleChangeTextColor.bind(this)),this.querySelector("input[aria-event='font-size'").addEventListener("change",this.handleChangeTextSize.bind(this)),this.querySelector("select-font").addEventListener("onChangeSelect",this.handleChangeTextFont.bind(this))}}class N extends HTMLElement{constructor(){super(),this.elementId=""}render(){let e=this.template();this.innerHTML=e,this.hide()}template(){return'\n        <label class="form-label text-light">위치</label>\n        <div class="d-flex flex-row bd-highlight mb-2">\n        <input aria-event="location-x" type="number" class="form-control bg-default text-light me-1" value="0" >\n        <input aria-event="location-y" type="number" class="form-control bg-default text-light" value="0" >\n\n        </div>'}hide(){this.classList.add("d-none")}show(){this.classList.remove("d-none")}setElementId({elementId:e}){this.elementId=e,this.updateValue()}updateValue(){const e=document.querySelector("element-timeline").timeline;this.querySelector("input[aria-event='location-x'").value=e[this.elementId].location.x,this.querySelector("input[aria-event='location-y'").value=e[this.elementId].location.y}handleLocation(){document.querySelector("element-control");const e=document.querySelector(`element-control-asset[element-id='${this.elementId}']`);let t=this.querySelector("input[aria-event='location-x'").value,i=this.querySelector("input[aria-event='location-y'").value,n=e.convertAbsoluteToRelativeSize({x:t,y:i});e.changeLocation({x:n.x,y:n.y})}connectedCallback(){this.render(),this.querySelector("input[aria-event='location-x'").addEventListener("change",this.handleLocation.bind(this)),this.querySelector("input[aria-event='location-y'").addEventListener("change",this.handleLocation.bind(this))}}class B extends HTMLElement{constructor(){super(),this.elementId=""}render(){let e=this.template();this.innerHTML=e,this.hide()}template(){return'\n        <label class="form-label text-light">위치</label>\n        <div class="d-flex flex-row bd-highlight mb-2">\n        <input aria-event="location-x" type="number" class="form-control bg-default text-light me-1" value="0" >\n        <input aria-event="location-y" type="number" class="form-control bg-default text-light" value="0" >\n\n        </div>'}hide(){this.classList.add("d-none")}show(){this.classList.remove("d-none")}setElementId({elementId:e}){this.elementId=e,this.updateValue()}updateValue(){const e=document.querySelector("element-timeline").timeline;this.querySelector("input[aria-event='location-x'").value=e[this.elementId].location.x,this.querySelector("input[aria-event='location-y'").value=e[this.elementId].location.y}handleLocation(){const e=document.querySelector(`element-control-asset[element-id='${this.elementId}']`);let t=this.querySelector("input[aria-event='location-x'").value,i=this.querySelector("input[aria-event='location-y'").value,n=e.convertAbsoluteToRelativeSize({x:t,y:i});e.changeLocation({x:n.x,y:n.y})}connectedCallback(){this.render(),this.querySelector("input[aria-event='location-x'").addEventListener("change",this.handleLocation.bind(this)),this.querySelector("input[aria-event='location-y'").addEventListener("change",this.handleLocation.bind(this))}}class O extends HTMLElement{constructor(){super(),this.value="",this.elementId=this.getAttribute("element-id"),this.timeline=document.querySelector("element-timeline").timeline,this.parentInputBox=document.querySelector(`element-control-asset[element-id="${this.elementId}"]`)}render(){let e=this.template();this.innerHTML=e,this.style.textAlign="center",this.style.display="flex",this.style.justifyContent="center",this.style.height="100%",this.style.width="100%",this.style.position="absolute",this.style.top="0px",this.style.color="#ffffff",this.querySelector("span").style.height="100%",this.querySelector("span").style.outline="none",this.querySelector("span").setAttribute("contenteditable",!0),this.setWidthInner()}template(){return"<span>텍스트</span>"}setWidth(){this.parentInputBox.style.width=`${this.offsetWidth}px`}setWidthInner(){let e=this.parentInputBox.convertRelativeToAbsoluteSize({w:this.querySelector("span").offsetWidth});this.timeline[this.elementId].widthInner=e.w}updateText({event:e}){let t=e.currentTarget.textContent;this.value=t,this.timeline[this.elementId].text=t}handleInput(e){this.updateText({event:e}),this.setWidth(),this.setWidthInner()}connectedCallback(){this.render(),this.querySelector("span").addEventListener("input",this.handleInput.bind(this))}}class j extends HTMLElement{constructor(){super(),this.path="",this.type="",this.fontname="",this.onChangeSelect=new Event("onChangeSelect")}render(){let e=this.template();this.innerHTML=e,this.insertFontLists()}template(){return"<select ref='lists' class=\"form-select form-control bg-default text-light\" aria-label=\"Default select example\">\n        <option selected>Noto Sans KR medium</option>\n\n      </select>\n      <style ref='fontStyles'>\n      </style>\n      "}insertFontLists(){window.electronAPI.req.font.getLists().then((e=>{if(0==e.status)return 0;for(let t=0;t<e.fonts.length;t++){const i=e.fonts[t];this.querySelector("select[ref='lists']").insertAdjacentHTML("beforeend",`<option value-index="${t+1}" value='${i.path}'>${i.name}</option>`)}}))}handleSelect(){this.path=this.querySelector("select[ref='lists']").value,this.fontname=this.querySelector("select[ref='lists']").value.split("/")[this.querySelector("select[ref='lists']").value.split("/").length-1].split(".")[0],this.type=this.querySelector("select[ref='lists']").value.split("/")[this.querySelector("select[ref='lists']").value.split("/").length-1].split(".")[1],this.applyFontStyle({fontName:this.fontname,fontPath:this.path,fontType:this.type}),this.dispatchEvent(this.onChangeSelect)}applyFontStyle({fontName:e,fontPath:t,fontType:i}){this.querySelector("style[ref='fontStyles']").insertAdjacentHTML("beforeend",`\n        @font-face {\n            font-family: "${e}";\n            src: local("${e}"),\n              url("${t}") format("${i}");\n        }\n        `)}connectedCallback(){this.render(),this.querySelector("select[ref='lists']").addEventListener("change",this.handleSelect.bind(this))}}customElements.define("asset-list",c),customElements.define("asset-file",u),customElements.define("asset-folder",p),customElements.define("asset-browser",y),customElements.define("asset-upload-drop",g),customElements.define("element-timeline",S),customElements.define("element-timeline-cursor",E),customElements.define("element-timeline-ruler",L),customElements.define("element-timeline-range",I),customElements.define("element-bar",q),customElements.define("element-control",A),customElements.define("element-control-asset",P),customElements.define("drag-alignment-guide",M),customElements.define("keyframe-editor",$),customElements.define("menu-dropdown-body",C),customElements.define("menu-dropdown-item",k),customElements.define("animation-panel",z),customElements.define("animation-panel-item",H),customElements.define("option-group",R),customElements.define("option-text",D),customElements.define("option-image",N),customElements.define("option-video",B),customElements.define("input-text",O),customElements.define("select-font",j),NUGGET=t})();