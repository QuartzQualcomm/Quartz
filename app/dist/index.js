var nugget;(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{asset:()=>d,canvas:()=>u,element:()=>o});const n={},i={scroller:void 0,isPaused:!0,progress:split_inner_bottom.scrollLeft,start:function(){let e=document.querySelector("#playToggle");e.setAttribute("onclick","nugget.element.player.stop()"),e.innerHTML='<i class="fas fa-pause text-light"></i>',i.scroller=setInterval((function(){let e=Number(timeline_bar.style.left.split("px")[0])+4;timeline_bar.style.left=`${e}px`,i.progress=e,split_inner_bottom.innerWidth+split_inner_bottom.offsetWidth>=split_inner_bottom.offsetWidth&&i.stop(),a.play()}),20),i.isPaused=!1},stop:function(){clearInterval(i.scroller),i.isPaused=!0;let e=document.querySelector("#playToggle");e.setAttribute("onclick","nugget.element.player.start()"),e.innerHTML='<i class="fas fa-play text-light"></i>',a.pauseAllVideo()},reset:function(){timeline_bar.style.left="0px",i.progress=0,i.isPaused=!0}},l={event:{drag:{onmousedown:function(e){valueEvent.elementBar.blob=e.getAttribute("value"),valueEvent.elementBar.isDrag=!0,valueEvent.elementBar.e=e,valueEvent.elementBar.criteria.x=valueEvent.mouse.x-Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")),valueEvent.elementBar.criteria.y=valueEvent.mouse.y},onmouseup:function(e){valueEvent.elementBar.isDrag=!1}},resize:{rangeonmousedown:function(e,t="left"){valueEvent.elementBar.e=e.parentNode.parentNode,valueEvent.elementBar.blob=valueEvent.elementBar.e.getAttribute("value"),valueEvent.elementBar.isResize=!0,valueEvent.elementBar.resizeLocation=t,valueEvent.elementBar.isDrag=!1,valueEvent.elementBar.criteria.duration=nugget.element.timeline[valueEvent.elementBar.blob.split("/")[3]].duration+Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")),valueEvent.elementBar.criteriaResize.x=Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")),valueEvent.elementBar.resizeRangeLeft=Number(valueEvent.elementBar.e.querySelector(".element-bar-hiddenspace-left").style.width.split("px")[0]),valueEvent.elementBar.resizeRangeRight=Number(valueEvent.elementBar.e.querySelector(".element-bar-hiddenspace-right").style.width.split("px")[0])},onmousedown:function(e,t="left"){valueEvent.elementBar.blob=e.parentNode.getAttribute("value"),valueEvent.elementBar.isResize=!0,valueEvent.elementBar.resizeLocation=t,valueEvent.elementBar.isDrag=!1,valueEvent.elementBar.e=e.parentNode,valueEvent.elementBar.criteriaResize.x="left"==t?valueEvent.mouse.x-Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")):Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")),valueEvent.elementBar.criteriaResize.y=valueEvent.mouse.y,valueEvent.elementBar.criteria.duration=nugget.element.timeline[valueEvent.elementBar.blob.split("/")[3]].duration+Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,""))},onmouseup:function(e){valueEvent.elementBar.isResize=!1}}},append:function(e){let t,i=document.querySelector("#split_inner_bottom"),l=e.split("/")[3],r=n[l].duration,a=n[l].filetype,o=n[l].localpath.split("/"),s=o[o.length-1];"video"==a&&(t=`<div class="element-bar" style="width: ${r}px; left: 0px;" onmousedown="nugget.element.bar.event.drag.onmousedown(this)" value="${e}">\n            ${s}\n            <div class="element-bar-hiddenspace-left position-absolute">\n                <div class="element-bar-resize-hiddenspace-left position-absolute" onmousedown="nugget.element.bar.event.resize.rangeonmousedown(this, 'left')">\n                </div>\n            </div>\n            <div class="element-bar-hiddenspace-right position-absolute">\n                <div class="element-bar-resize-hiddenspace-right position-absolute" onmousedown="nugget.element.bar.event.resize.rangeonmousedown(this, 'right')">\n                </div>\n            </div>\n            </div>`);let u="video"!=a?`<div class="element-bar" style="width: ${r}px; left: 0px;" onmousedown="nugget.element.bar.event.drag.onmousedown(this)" value="${e}">\n            ${s}\n            <div class="element-bar-resize-left position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedown(this, 'left')"></div>\n            <div class="element-bar-resize-right position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedown(this, 'right')"></div>\n            </div>`:t;i.insertAdjacentHTML("beforeend",u)},drag:function(e,t){valueEvent.elementBar.e.style.left=`${e}px`;let n=valueEvent.elementBar.blob.split("/")[3];nugget.element.timeline[n].startTime=e},resizeDurationInTimeline:function(e,t="left"){let i=valueEvent.elementBar.blob.split("/")[3],l=valueEvent.elementBar.criteria.duration;"left"==t?(valueEvent.elementBar.e.style.left=`${e}px`,valueEvent.elementBar.e.style.width=l-e+"px",n[i].startTime=e,n[i].duration=Number(valueEvent.elementBar.e.style.width.split("px")[0])):(valueEvent.elementBar.e.style.left=`${valueEvent.elementBar.criteriaResize.x}px`,valueEvent.elementBar.e.style.width=split_inner_bottom.scrollLeft+valueEvent.mouse.x-valueEvent.elementBar.criteriaResize.x+"px",n[i].startTime=valueEvent.elementBar.criteriaResize.x,n[i].duration=Number(valueEvent.elementBar.e.style.width.split("px")[0]))},resizeRangeOnElement:function(e,t="left"){let i=valueEvent.elementBar.blob.split("/")[3],l=valueEvent.elementBar.criteria.duration,r=(valueEvent.elementBar.resizeRangeLeft,valueEvent.elementBar.resizeRangeRight,valueEvent.elementBar.e.querySelector(".element-bar-hiddenspace-left")),a=valueEvent.elementBar.e.querySelector(".element-bar-hiddenspace-right");"left"==t?(r.style.width=e-5+"px",n[i].trim.startTime=Number(r.style.width.split("px")[0])):(a.style.width=window.innerWidth-e-valueEvent.elementBar.criteriaResize.x+"px",n[i].trim.endTime=l-Number(a.style.width.split("px")[0]))}},r={state:{isResize:!1,criteriaResize:{x:0,y:0,w:0,h:0},resizeDirection:"",resizeTargetElementId:""},upload:{image:function(e,t){let n=document.createElement("img"),i=e.split("/")[3];n.src=e,n.onload=function(){var r=n.width/10,o=n.height/10;nugget.element.timeline[i]={startTime:0,duration:1e3,location:{x:0,y:0},width:r,height:o,localpath:t,filetype:"image"},a.show.image(e),l.append(e)}},video:function(e,t){let n=document.createElement("video"),i=e.split("/")[3];n.src=e,n.preload="metadata",n.onloadedmetadata=function(){let r=n.videoWidth/10,o=n.videoHeight/10,s=200*n.duration;nugget.element.timeline[i]={startTime:0,duration:s,location:{x:0,y:0},trim:{startTime:0,endTime:0},width:r,height:o,localpath:t,filetype:"video"},a.show.video(e),l.append(e)}}},drag:function(e,t,n){let i=["img","video"],l="";for(let t=0;t<i.length;t++)e.querySelector(i[t])&&(l=i[t]);let r=e.querySelector(l).getAttribute("src").split("/")[3];e.style.top=`${n}px`,e.style.left=`${t}px`,nugget.element.timeline[r].location.x=t,nugget.element.timeline[r].location.y=n,preview.clear()},dragover:function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){e.stopPropagation(),e.preventDefault()},onmouseup:function(e){r.state.isResize=!1;for(const e in n)Object.hasOwnProperty.call(n,e)&&document.querySelector(`#element-${e}`).setAttribute("draggable","true")},resize:{init:function(e,t="n"){let n=document.querySelector(`#element-${e}`);n.setAttribute("draggable","false"),r.state.criteriaResize.w=Number(n.style.width.split("px")[0]),r.state.criteriaResize.h=Number(n.style.height.split("px")[0]),r.state.criteriaResize.x=Number(n.style.left.split("px")[0]),r.state.criteriaResize.y=Number(n.style.top.split("px")[0]),r.state.isResize=!0,r.state.resizeTargetElementId=e,r.state.resizeDirection=t},action:function(e,t){let n=r.state.resizeTargetElementId,i=document.querySelector(`#element-${n}`);switch(r.state.resizeDirection){case"n":i.style.top=`${r.state.criteriaResize.y+t}px`,i.style.height=r.state.criteriaResize.h-t+"px";break;case"s":i.style.top=`${r.state.criteriaResize.y}px`,i.style.height=`${t}px`;break;case"w":i.style.left=`${r.state.criteriaResize.x+e}px`,i.style.width=r.state.criteriaResize.w-e+"px";break;case"e":i.style.left=`${r.state.criteriaResize.x}px`,i.style.width=`${e}px`}nugget.element.timeline[n].location.y=Number(i.style.top.split("px")[0]),nugget.element.timeline[n].location.x=Number(i.style.left.split("px")[0]),nugget.element.timeline[n].width=Number(i.style.width.split("px")[0]),nugget.element.timeline[n].height=Number(i.style.height.split("px")[0])}}},a={previewRatio:1920/preview.width,show:{image:function(e){let t=e.split("/")[3];null==document.getElementById(`element-${t}`)?control.insertAdjacentHTML("beforeend",`\n                <div id="element-${t}" class="element-drag" style='width: ${nugget.element.timeline[t].width}px; height: ${nugget.element.timeline[t].height}px; top: 0px; left: 0px;' draggable="true">\n                <img src="${e}" alt="" class="element-image" draggable="false">\n                <div class="resize-n" onmousedown="nugget.element.control.resize.init('${t}', 'n')"></div>\n                <div class="resize-s" onmousedown="nugget.element.control.resize.init('${t}', 's')"></div>\n                <div class="resize-w" onmousedown="nugget.element.control.resize.init('${t}', 'w')"></div>\n                <div class="resize-e" onmousedown="nugget.element.control.resize.init('${t}', 'e')"></div>\n    \n                </div>\n                `):document.querySelector(`#element-${t}`).classList.remove("d-none")},video:function(e){let t=e.split("/")[3];if(null==document.getElementById(`element-${t}`)){control.insertAdjacentHTML("beforeend",`\n                <div id="element-${t}" class="element-drag" style='width: ${nugget.element.timeline[t].width}px; height: ${nugget.element.timeline[t].height}px; top: 0px; left: 0px;' draggable="true">\n                <video src="${e}" alt="" class="element-video" draggable="false"></video>\n                <div class="resize-n" onmousedown="nugget.element.control.resize.init('${t}', 'n')"></div>\n                <div class="resize-s" onmousedown="nugget.element.control.resize.init('${t}', 's')"></div>\n                <div class="resize-w" onmousedown="nugget.element.control.resize.init('${t}', 'w')"></div>\n                <div class="resize-e" onmousedown="nugget.element.control.resize.init('${t}', 'e')"></div>\n    \n                </div>\n                `);let l=document.getElementById(`element-${t}`).querySelector("video"),r=(n[t].startTime-i.progress)/200;console.log(r),l.currentTime=r}else{let e=document.getElementById(`element-${t}`).querySelector("video"),l=-(n[t].startTime-i.progress)/200;e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2?(i.isPaused&&console.log("paused"),console.log("isPlaying")):(e.currentTime=l,e.play()),document.querySelector(`#element-${t}`).classList.remove("d-none")}}},hide:function(e){let t=e.split("/")[3];"video"==n[t].filetype&&a.pauseVideo(t),document.querySelector(`#element-${t}`).classList.add("d-none")},play:function(){let e;for(e in nugget.element.timeline){let t=`blob:${location.origin}/${e}`,l=nugget.element.timeline[e].filetype,r=nugget.element.timeline[e].startTime>i.progress||nugget.element.timeline[e].startTime+nugget.element.timeline[e].duration<i.progress;"video"==l&&(r=n[e].startTime+n[e].trim.startTime>i.progress||n[e].startTime+n[e].trim.endTime<i.progress),r?a.hide(t):a.show[l](t)}},pauseVideo:function(e){document.getElementById(`element-${e}`).querySelector("video").pause()},pauseAllVideo:function(){let e;for(e in n)"video"==n[e].filetype&&document.getElementById(`element-${e}`).querySelector("video").pause()}},o={timeline:n,player:i,bar:l,control:r,preview:a},s={mediaRecorder:void 0,resize:function(){let e=.65*window.innerWidth,t=9*e/16;preview.width=e,preview.height=t,preview.style.width=`${e}px`,preview.style.height=`${t}px`,video.style.width=`${e}px`,video.style.height=`${t}px`,nugget.element.preview.previewRatio=1920/e},render:function(e){let t,n=e.getContext("2d");for(t in preview.clear(),nugget.element.timeline){let e=`blob:${location.origin}/${t}`;if(nugget.element.timeline[t].startTime>nugget.element.player.progress||nugget.element.timeline[t].startTime+nugget.element.timeline[t].duration<nugget.element.player.progress);else{let i=new Image;i.src=e,n.drawImage(i,nugget.element.timeline[t].location.x,nugget.element.timeline[t].location.y,nugget.element.timeline[t].width,nugget.element.timeline[t].height)}}let i=document.getElementById("split_inner_bottom");i.scrollWidth-i.offsetWidth<=nugget.element.player.progress+1&&null!=s.mediaRecorder&&s.mediaRecorder.stop()},clear:function(e){preview.width=preview.width},export:function(){let e=[];return new Promise((function(t,n){let i=preview.captureStream(60);s.mediaRecorder=new MediaRecorder(i,{mimeType:"video/webm; codecs=vp9"}),s.mediaRecorder.start(0),s.mediaRecorder.ondataavailable=function(t){e.push(event.data)},s.mediaRecorder.onstop=function(n){let i=new Blob(e,{type:"video/webm"}),l=URL.createObjectURL(i);t({url:l,blobVideo:i}),exportVideo.src=l,exportVideoModal.show()},nugget.element.player.start(),s.render()}))}},u={preview:s},m={nowDirectory:"",loadFile:function(e,t){document.querySelector("#assetBrowser").insertAdjacentHTML("beforeend",`\n            <div class="col-6 d-flex flex-column bd-highlight overflow-hidden asset mt-1" onclick="nugget.asset.add('${t}/${e}', '${t}')">\n                <i class="fas fa-file icon-lg align-self-center"></i>\n                <b class="align-self-center text-light">${e}</b>\n            </div>`)},loadFolder:function(e,t){document.querySelector("#assetBrowser").insertAdjacentHTML("beforeend",`\n            <div class="col-6 d-flex flex-column bd-highlight overflow-hidden asset mt-1" onclick="ipc.requestAllDir('${t}/${e}')">\n                <i class="fas fa-folder icon-lg align-self-center"></i>\n                <b class="align-self-center text-light">${e}</b>\n            </div>`)},loadPrevDirectory:function(){let e=m.nowDirectory.split("/"),t=e.slice(-e.length,-1);ipc.requestAllDir(t.join("/"))},add:function(e,t){fetch(`file://${e}`).then((e=>e.blob())).then((t=>{let n=URL.createObjectURL(t),i=t.type.split("/")[0];nugget.element.control.upload[i](n,e)}))}},d=m;nugget=t})();