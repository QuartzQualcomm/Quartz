var nugget;(()=>{"use strict";var e={d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{canvas:()=>a,element:()=>r});const n={scroller:void 0,isPaused:!0,progress:split_inner_bottom.scrollLeft,start:function(){n.scroller=setInterval((function(){let e=Number(timeline_bar.style.left.split("px")[0])+4;timeline_bar.style.left=`${e}px`,n.progress=e,split_inner_bottom.innerWidth+split_inner_bottom.offsetWidth>=split_inner_bottom.offsetWidth&&n.stop(),i.play()}),20),n.isPaused=!1},stop:function(){clearInterval(n.scroller),n.isPaused=!0},reset:function(){timeline_bar.style.left="0px",n.progress=0,n.isPaused=!0}},l={upload:{image:function(e){let t=document.createElement("img"),n=e.split("/")[3];t.src=e,t.onload=function(){var l=t.width/10,r=t.height/10;nugget.element.timeline[n]={startTime:0,duration:1e3,location:{x:0,y:0},width:l,height:r},i.show(e)}}},drag:function(e,t,n){let l=e.querySelector("img").getAttribute("src").split("/")[3];e.style.top=`${n}px`,e.style.left=`${t}px`,nugget.element.timeline[l].location.x=t,nugget.element.timeline[l].location.y=n,preview.clear(),preview.render()},dragover:function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){e.stopPropagation(),e.preventDefault()}},i={show:function(e){let t=e.split("/")[3];null==document.getElementById(`element-${t}`)?control.insertAdjacentHTML("beforeend",`\n            <div id="element-${t}" class="element-drag" style='width: ${nugget.element.timeline[t].width}px; top: 0px; left: 0px;' draggable="true">\n            <img src="${e}" alt="" class="element-image" draggable="false">\n            </div>\n            `):document.querySelector(`#element-${t}`).classList.remove("d-none")},hide:function(e){let t=e.split("/")[3];document.querySelector(`#element-${t}`).classList.add("d-none")},play:function(){let e;for(e in preview.render(),nugget.element.timeline){let t=`blob:${location.origin}/${e}`;nugget.element.timeline[e].startTime>n.progress||nugget.element.timeline[e].startTime+nugget.element.timeline[e].duration<n.progress?i.hide(t):i.show(t)}}},r={timeline:{},player:n,bar:{event:{drag:{onmousedown:function(e){valueEvent.elementBar.blob=e.getAttribute("value"),valueEvent.elementBar.isDrag=!0,valueEvent.elementBar.e=e,valueEvent.elementBar.criteria.x=valueEvent.mouse.x-Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")),valueEvent.elementBar.criteria.y=valueEvent.mouse.y},onmouseup:function(e){valueEvent.elementBar.isDrag=!1}},resize:{onmousedown:function(e,t="left"){valueEvent.elementBar.blob=e.parentNode.getAttribute("value"),valueEvent.elementBar.isResize=!0,valueEvent.elementBar.resizeLocation=t,valueEvent.elementBar.isDrag=!1,valueEvent.elementBar.e=e.parentNode,valueEvent.elementBar.criteriaResize.x="left"==t?valueEvent.mouse.x-Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")):Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,"")),valueEvent.elementBar.criteriaResize.y=valueEvent.mouse.y,valueEvent.elementBar.criteria.duration=nugget.element.timeline[valueEvent.elementBar.blob.split("/")[3]].duration+Number(valueEvent.elementBar.e.style.left.replace(/[^0-9]/g,""))},onmouseup:function(e){valueEvent.elementBar.isResize=!1}}},append:function(e){document.querySelector("#split_inner_bottom").insertAdjacentHTML("beforeend",`<div class="element-bar" style="width: 1000px; left: 0px;" onmousedown="nugget.element.bar.event.drag.onmousedown(this)" value="${e}">\n            ${e}\n            <div class="element-bar-resize-left position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedown(this, 'left')"></div>\n            <div class="element-bar-resize-right position-absolute" onmousedown="nugget.element.bar.event.resize.onmousedown(this, 'right')"></div>\n\n        </div>`)},drag:function(e,t){valueEvent.elementBar.e.style.left=`${e}px`;let n=valueEvent.elementBar.blob.split("/")[3];nugget.element.timeline[n].startTime=e},resizeTime:function(e,t="left"){let n=valueEvent.elementBar.blob.split("/")[3],l=valueEvent.elementBar.criteria.duration;"left"==t?(valueEvent.elementBar.e.style.left=`${e}px`,valueEvent.elementBar.e.style.width=l-e+"px",nugget.element.timeline[n].startTime=e,nugget.element.timeline[n].duration=Number(valueEvent.elementBar.e.style.width.split("px")[0])):(valueEvent.elementBar.e.style.left=`${valueEvent.elementBar.criteriaResize.x}px`,valueEvent.elementBar.e.style.width=valueEvent.mouse.x-valueEvent.elementBar.criteriaResize.x+"px",nugget.element.timeline[n].startTime=valueEvent.elementBar.criteriaResize.x,nugget.element.timeline[n].duration=Number(valueEvent.elementBar.e.style.width.split("px")[0]))}},control:l,preview:i},o={mediaRecorder:void 0,resize:function(){let e=.65*window.innerWidth,t=9*e/16;preview.width=e,preview.height=t,preview.style.width=`${e}px`,preview.style.height=`${t}px`,video.style.width=`${e}px`,video.style.height=`${t}px`},render:function(e){let t,n=e.getContext("2d");for(t in preview.clear(),nugget.element.timeline){let e=`blob:${location.origin}/${t}`;if(nugget.element.timeline[t].startTime>nugget.element.player.progress||nugget.element.timeline[t].startTime+nugget.element.timeline[t].duration<nugget.element.player.progress);else{let l=new Image;l.src=e,n.drawImage(l,nugget.element.timeline[t].location.x,nugget.element.timeline[t].location.y,nugget.element.timeline[t].width,nugget.element.timeline[t].height)}}let l=document.getElementById("split_inner_bottom");l.scrollWidth-l.offsetWidth<=nugget.element.player.progress+1&&null!=o.mediaRecorder&&o.mediaRecorder.stop()},clear:function(e){preview.width=preview.width},export:function(){let e=[];return new Promise((function(t,n){let l=preview.captureStream(60);o.mediaRecorder=new MediaRecorder(l,{mimeType:"video/webm; codecs=vp9"}),o.mediaRecorder.start(0),o.mediaRecorder.ondataavailable=function(t){e.push(event.data)},o.mediaRecorder.onstop=function(n){let l=new Blob(e,{type:"video/webm"}),i=URL.createObjectURL(l);t({url:i,blobVideo:l}),exportVideo.src=i,exportVideoModal.show()},nugget.element.player.start(),o.render()}))}},a={preview:o};nugget=t})();